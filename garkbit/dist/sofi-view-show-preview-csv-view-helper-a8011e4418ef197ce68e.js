(self.webpackJsonp=self.webpackJsonp||[]).push([[77],{126:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressView=t.ProgressModel=void 0;var o,n,i=a(r(1)),s=r(2),c=a(r(3));function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.ProgressModel=o=function(){var e=(p(t,i.default.Model),t);function t(){return u(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.defaults={valuemin:0,valuemax:100,valuenow:0},e}.call(void 0),t.ProgressView=n=function(){var e=(p(t,s.View),t);function t(){return u(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.template=c.default.renderable(function(t){return c.default.div(".progress",function(){var e;return{valuemin:t.valuemin,valuemax:t.valuemax,valuenow:t.valuenow},e=Math.floor(t.valuenow/t.valuemax*100+.5),c.default.div(".progress-bar.progress-bar-striped",{role:"progressbar",style:"width: "+e+"%"},function(){return c.default.span({style:"color:black;"},t.valuenow+" of "+t.valuemax+".")})})}),e.prototype.modelEvents={change:"render"},e}.call(void 0),t.ProgressModel=o,t.ProgressView=n},548:function(e,t,r){"use strict";var o=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l,a,u,p,f,d,h,v,b,w,y,g,m,_,k,O,C,j,x,P,q,R,M,V,E,N,S=[].indexOf;j=r(0),r(4),u=r(1),y=r(2),r(87),N=r(3),M=r(89),r(5);var T=r(31);T.make_field_input,T.make_field_select,r(31).form_group_input_div;var A=r(17);E=A.modal_close_button;var D=r(126);k=D.ProgressModel,O=D.ProgressView,w=u.Radio.channel("global"),g=u.Radio.channel("messages"),l=u.Radio.channel("sofi"),p=w.request("main:app:BaseModalView"),a=w.request("main:app:AuthUnPaginated"),C=function(){var e=(c(t,a),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.url="/api/dev/bapi/ebcomicworkspace",e}.call(void 0),R=new u.Collection,l.reply("get-csvrow-collection",function(){return R}),V=function(){var e,t,r;for(t in r=[],e=l.request("get-csv-header"))r.push(e[t]);return""+r.join(",")},q=function(){var e,t,r,o,n,i,s,c,a,u;for(e=l.request("get-csvrow-collection"),l.request("get-csv-header"),s=[V()],o=0,n=(c=e.models).length;o<n;o++){for(r in u=[],t=c[o].toJSON())a=(a=t[r]).split('"').join('""'),0<=S.call(a," ")&&(a='"'+a+'"'),u.push(a);i=u.join(","),s.push(i)}return s.join("\r\n")+"\r\n"},m=function(){var e=(c(t,p),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.template=N.renderable(function(e){return e.mainsection,N.div(".modal-dialog",function(){return N.div(".modal-content",function(){return N.h4("Title: "+e.Title),N.div(".modal-body",function(){return N.h4("Description:"),N.hr(),N.div(".panel",function(){return N.raw(e.Description)})}),N.div(".modal-footer",function(){return N.ul(".list-inline",function(){return"btn.btn-default.btn-sm",N.li("#close-modal",function(){return E("Close","check")})})})})})}),e}.call(void 0),_=function(){var e=(c(t,p),o(t,[{key:"templateContext",value:function(){var e;return(e=this.options).csvheader=l.request("get-csv-header"),e}}]),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.template=N.renderable(function(t){return N.div(".modal-dialog",function(){return N.div(".modal-content",function(){return N.h3("Title: "+t.Title),N.div(".modal-body",function(){return N.h4("CSV Row:"),N.hr(),N.div(".panel",function(){return N.dl(".dl-horizontal",function(){return Object.keys(t).forEach(function(e){return N.dt(t.csvheader[e]),N.dd(t[e])})})})}),N.div(".modal-footer",function(){return N.ul(".list-inline",function(){return N.li("#close-modal",function(){return E("Close","check")})})})})})}),e}.call(void 0),P=["max-width:0","overflow:hidden","text-overflow:ellipsis","white-space:nowrap"].join(";")+";",b=function(){var e=(c(t,y.View),o(t,[{key:"templateContext",value:function(){var e;return(e=this.options).csvheader=l.request("get-csv-header"),e}},{key:"show_row",value:function(){var e;return e=new _({model:this.model}),w.request("show-modal",e)}},{key:"show_description",value:function(){var e;return e=new m({model:this.model}),w.request("show-modal",e)}}]),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.tagName="tr",e.prototype.template=N.renderable(function(t){return N.td(function(){return N.div(".btn-group.btn-group-justified",function(){return N.div(".show-desc-button.btn.btn-default.btn-xs",function(){return N.i(".fa.fa-eye")}),N.div(".show-row-button.btn.btn-default.btn-xs",function(){return N.i(".fa.fa-list")})})}),Object.keys(t.csvheader).forEach(function(e){return N.td({style:P},t[e])})}),e.prototype.ui={desc_btn:".show-desc-button",row_btn:".show-row-button"},e.prototype.events={"click @ui.desc_btn":"show_description","click @ui.row_btn":"show_row"},e}.call(void 0),v=function(){var e=(c(t,y.CollectionView),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.tagName="tbody",e.prototype.childView=b,e}.call(void 0),x=["table","table-striped","table-bordered","table-hover","table-condensed"],h=function(){var e=(c(t,y.View),o(t,[{key:"templateContext",value:function(){var e;return(e=this.options).ebcfg_collection=l.request("db:ebcfg:collection"),e.ebdsc_collection=l.request("db:ebdsc:collection"),e.csvheader=l.request("get-csv-header"),e}},{key:"onRender",value:function(){var e,t;return e=l.request("get-csvrow-collection"),t=new v({collection:e}),this.showChildView("body",t)}}]),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.tagName="table",e.prototype.className=x.join(" "),e.prototype.template=N.renderable(function(t){return N.div(".table-responsive",function(){return N.table("."+x.join("."),function(){return N.thead(function(){return N.tr(".info",function(){return N.td(function(){return N.i(".fa.fa-eye.fa-3x")}),Object.keys(t.csvheader).forEach(function(e){return N.th(t.csvheader[e])})})}),N.tbody()})})}),e.prototype.regions={body:{el:"tbody",replaceElement:!0}},e}.call(void 0),d=function(){var e=(c(t,y.Object),o(t,[{key:"initialize",value:function(e){return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,t),this.currentItems=j.clone(e.items),this.progressModel=e.progressModel,this.progressModel.set("valuemax",this.currentItems.length),this.channel=this.getChannel(),this.rowOptions={action:e.action,cfg:e.cfg,desc:e.dsc}}},{key:"createCsvRow",value:function(e){var t,r,o=this;return r=j.extend(this.rowOptions,{comic:e}),t=l.request("create-csv-row-object",r),this.currentRows.push(t),this.progressModel.set("valuenow",this.currentRows.length),this.currentRows.length!==this.currentItems.length?setTimeout(function(){return o.createAnotherRow()},5):this.trigger("csv:rows:created")}},{key:"createAnotherRow",value:function(){var e;if(this.currentClones.length)return e=this.currentClones.pop(),this.createCsvRow(e)}},{key:"createCsvRows",value:function(){return this.currentClones=j.clone(this.currentItems),this.progressModel.set("valuemax",this.currentClones.length),this.progressModel.set("valuenow",0),this.currentRows=[],this.createAnotherRow()}}]),t);function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.initialize=e.initialize.bind(e),e}return e.prototype.channelName="sofi",e}.call(void 0),f=function(){var e=(c(t,y.View),o(t,[{key:"templateContext",value:function(){var e;return(e=this.options).ebcfg_collection=l.request("db:ebcfg:collection"),e.ebdsc_collection=l.request("db:ebdsc:collection"),e.workspace=l.request("locals:get","currentCsvWorkspace"),e}},{key:"open_fileexchange_tab",value:function(){return window.open("http://bulksell.ebay.com/ws/eBayISAPI.dll?FileExchangeUploadForm","_blank")}},{key:"make_csv_file",value:function(){var e,t,r,o;return q(),t=new Date,o=M(t,"yyyy-mm-dd-HH:MM:ss"),e=this.ui.filename_input.val()||"export-"+o+".csv",r={type:"data:text/csv;charset=utf-8",data:q(),el_id:"exported-csv-anchor",filename:e},w.request("export-to-file",r)}},{key:"createCsvRows",value:function(){var e,t,r=this;return this.currentRows=[],l.request("locals:get","currentCsvAction"),l.request("locals:get","currentCsvCfg"),l.request("locals:get","currentCsvDsc"),e=l.request("locals:get","currentCsvWorkspace"),w.request("main:app:AuthUnPaginated"),(t=new C).fetch({data:{withRelated:["comic","comic.photos"],where:{name:e}}}).done(function(){return r.parseRows(t)})}},{key:"parseRows",value:function(e){var t,r;return e.toJSON(),r=[],e.toJSON().forEach(function(e){return r.push(e.comic)}),(t=new d({items:r,progressModel:this.createModel,action:l.request("locals:get","currentCsvAction"),cfg:l.request("locals:get","currentCsvCfg"),dsc:l.request("locals:get","currentCsvDsc"),workspace:l.request("locals:get","currentCsvWorkspace")})).createCsvRows(),t.on("csv:rows:created",function(){return l.request("get-csvrow-collection").set(t.currentRows)})}},{key:"showCreateProgressBar",value:function(){var e;return this.createModel=new k,e=new O({model:this.createModel}),this.showChildView("createProgress",e)}},{key:"onRender",value:function(){var e,t,r;return this.showCreateProgressBar(),t=l.request("get-comic-image-urls"),Object.keys(t).length||g.request("warning","No pictures attached, please view comics, then create csv"),this.createCsvRows(),e=l.request("get-csvrow-collection"),r=new h({collection:e}),this.showChildView("body",r)}}]),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.regions={createProgress:".create-progress",body:".body"},e.prototype.template=N.renderable(function(e){var t,r;return r=new Date,t="export-"+M(r,"mmddHHMM")+".csv",N.div(".listview-header",function(){return N.text("Preview "+e.workspace+" CSV")}),N.div(".fileexchange-button.btn.btn-default","Ebay Upload"),N.div(".mkcsv-button.btn.btn-default","Create CSV"),N.input(".form-control",{value:t,name:"csvfilename"}),N.div(".create-progress"),N.div(".body")}),e.prototype.ui={mkcsv_btn:".mkcsv-button",filename_input:"input[name='csvfilename']",fileexchange_btn:".fileexchange-button"},e.prototype.events={"click @ui.mkcsv_btn":"make_csv_file","click @ui.fileexchange_btn":"open_fileexchange_tab"},e}.call(void 0),e.exports=f}}]);
//# sourceMappingURL=sofi-view-show-preview-csv-view-helper-a8011e4418ef197ce68e.js.map