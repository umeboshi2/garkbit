(self.webpackJsonp=self.webpackJsonp||[]).push([[39],{415:function(e,t,n){"use strict";var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}var l,c,p,f,d,h,_,m,v;c=n(1),f=n(2),n(87),v=n(3),m=n(5).default;var b=n(31);b.make_field_input,b.make_field_select,c.Radio.channel("global"),d=c.Radio.channel("messages"),l=c.Radio.channel("ebcsv"),_=v.renderable(function(e){return v.article(".document-view.content",function(){return v.div(".body",function(){return v.div(".card",function(){return v.div(".card-header",function(){return v.text("Drop an xml file, or use the "),v.button(".sample-comics-button.btn.btn-default","Example data.")}),v.div(".card-body",function(){return v.div(".parse-btn.btn.btn-default",{style:"display:none"},function(){return v.text("Parse Dropped File")}),v.input(".xml-file-input.input",{type:"file"}),v.span(".parse-chosen-button.btn.btn-default",{style:"display:none"},function(){return v.text("Parse input file.")})})})})})}),h=function(){var e=(s(t,c.Model),r(t,[{key:"fetch",value:function(e){return(e=e||{}).dataType="text",function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fetch",this).call(this,e)}},{key:"parse",value:function(e,t){return{content:e}}}]),t);function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.url="/assets/documents/sample-comics.xml",e}.call(void 0),p=function(){var e=(s(n,f.View),r(n,[{key:"file_input_clicked",value:function(e){return console.log("file_input_clicked",e),this.ui.file_input.val(null),this.ui.chosen_btn.hide()}},{key:"file_input_changed",value:function(e){return console.log("file_input_changed",e),this.ui.chosen_btn.show()}},{key:"handle_drop",value:function(e){var t;return e.preventDefault(),this.$el.css("border","0px"),t=e.originalEvent.dataTransfer.files[0],this.ui.status_msg.text("File: "+t.name),this.droppedFile=t,this.ui.parse_btn.show()}},{key:"handle_dragOver",value:function(e){return e.preventDefault(),e.stopPropagation()}},{key:"handle_dragEnter",value:function(e){return e.stopPropagation(),e.preventDefault(),this.$el.css("border","2px dotted")}},{key:"successfulParse",value:function(){return u(this,n),this.ui.status_msg.text("Parse Successful"),m("#ebcsv")}},{key:"parse_chosen_xml",value:function(){var e,t;return this.ui.status_msg.text("Reading xml file..."),this.ui.file_input.val(),this.ui.file_input,e=this.ui.file_input[0].files[0],(t=new FileReader).onload=this.xmlReaderOnLoad,t.readAsText(e),this.ui.parse_btn.hide()}},{key:"xmlReaderOnLoad",value:function(e){var t;return u(this,n),t=e.target.result,this.ui.status_msg.text("Parsing xml....."),l.request("parse-comics-xml",t,this.successfulParse)}},{key:"parse_xml",value:function(){var e;return this.ui.status_msg.text("Reading xml file..."),(e=new FileReader).onload=this.xmlReaderOnLoad,e.readAsText(this.droppedFile),this.ui.parse_btn.hide()}},{key:"parse_sample_xml",value:function(){var t,e,n=this;return e=(t=new h).fetch(),this.ui.status_msg.text("Retrieving xml...."),e.done(function(){var e;return n.ui.status_msg.text("Parsing xml...."),e=t.get("content"),l.request("parse-comics-xml",e,n.successfulParse)}),e.fail(function(){return n.ui.status_msg.text("Something failed."),d.danger("Failed to parse sample comics")})}}]),n);function n(){a(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return e.successfulParse=e.successfulParse.bind(e),e.xmlReaderOnLoad=e.xmlReaderOnLoad.bind(e),e}return e.prototype.template=_,e.prototype.droppedFile=null,e.prototype.ui={status_msg:".card-header",file_input:".xml-file-input",parse_btn:".parse-btn",chosen_btn:".parse-chosen-button",sampleComicsBtn:".sample-comics-button"},e.prototype.events={dragover:"handle_dragOver",dragenter:"handle_dragEnter",drop:"handle_drop","click @ui.parse_btn":"parse_xml","click @ui.file_input":"file_input_clicked","change @ui.file_input":"file_input_changed","click @ui.chosen_btn":"parse_chosen_xml","click @ui.sampleComicsBtn":"parse_sample_xml"},e}.call(void 0),e.exports=p}}]);
//# sourceMappingURL=ebcsv-view-upload-xml-view-82000172a794a3c2854a.js.map