(self.webpackJsonp=self.webpackJsonp||[]).push([[63],{575:function(t,e,o){"use strict";var n=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),i=s(o(1)),r=o(2),a=s(o(3)),u=(s(o(8)),s(o(153))),l=s(o(6)),c=s(o(576));function s(t){return t&&t.__esModule?t:{default:t}}var d,f,p,h,A,g,b=function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")};o(154),p=i.default.Radio.channel("global"),d=i.default.Radio.channel("sunny"),f=i.default.Radio.channel("gps"),p.request("main:app:AuthModel"),p.request("main:app:AuthCollection"),a.default.renderable(function(t){return a.default.div(function(){return a.default.h2("Map View"),a.default.div(".checkbox",function(){return a.default.label(function(){return a.default.input("#watch-map",{type:"checkbox"}),a.default.text("watch")})}),a.default.div("#map-view",{style:"height:20em;"})})}),A=a.default.renderable(function(t){return a.default.div(".row",function(){return a.default.h2("Map View"),a.default.div(".checkbox",function(){return a.default.label(function(){return a.default.input("#watch-map",{type:"checkbox"}),a.default.text("watch")})})}),a.default.div(".row",function(){return a.default.div("#map-view.col-md-4",{style:"height:20em;"})})}),g=u.default.icon({iconUrl:c.default}),h=function(){var t=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.getCenter=t.getCenter.bind(t),t.onLocationError=t.onLocationError.bind(t),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.View),n(e,[{key:"watch_button",value:function(t){return console.log("somwthing happened",t),t.target.checked?(console.log("Watch me!!!!",this.ui.map),this.Map.locate({watch:!0})):(console.log("Stop watching me....",this.ui.map),this.Map.locate({watch:!1}))}},{key:"addYardMarkers",value:function(){var t,e=this;return(t=d.request("db:yard:collection")).fetch({data:{limit:50}}).done(function(){var o,n,i,r,a;for(console.log("YARDS",t),a=[],o=0,n=(r=t.models).length;o<n;o++)i=r[o],a.push(function(t){var o,n,i;if((o=t.attributes.location).latitude)return n=[o.latitude,o.longitude],(i=u.default.marker(n,{icon:g,url:"#sunny/yards/view/"+o.id,title:t.attributes.name})).on("click",function(){return(0,l.default)("#sunny/yards/view/"+t.id)}),i.addTo(e.Map)}(i));return a})}},{key:"addPositionMarkers",value:function(){var t,e=this;return(t=f.request("position-collection")).fetch().done(function(){var o,n,i,r,a,l,c;for(c=[],n=0,i=(l=t.models).length;n<i;n++)(o=l[n].attributes).latitude?(r=[o.latitude,o.longitude],a=u.default.marker(r,{icon:g,url:"#sunny/yards/view/"+o.id}),console.log("marker location",r,o.id),c.push(a.addTo(e.Map))):c.push(void 0);return c})}},{key:"onDomRefresh",value:function(){var t;return this.Map=u.default.map("map-view"),13,[31.33,-89.28],this.Map.on("moveend",this.getCenter),this.Map.on("locationerror",this.onLocationError),this.Map.locate({setView:!0,watch:!1,enableHighAccuracy:!0}),(t=u.default.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png")).addTo(this.Map),console.log("MAP, LAYER",this.Map,t),this.addYardMarkers()}},{key:"getCenter",value:function(t){return b(this,e),console.log(this.Map.getCenter())}},{key:"onLocationError",value:function(t){var o;if(b(this,e),console.log("unable to get location",t),!this.first_location_error)return console.log("initialize map location"),o=[31.33,-89.28],this.Map.setView(o,13),this.first_location_error=!0}}]),e}();return t.prototype.template=A,t.prototype.ui={map:"#map-view",watch:"#watch-map"},t.prototype.events={"change @ui.watch":"watch_button"},t.prototype.defaultMapStyle="height:20em;",t.prototype.fsMapStyle="position: absolute; top: 0; right: 0; bottom: 0; left: 0;",t.prototype.first_location_error=!1,t}.call(void 0),t.exports=h},576:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUlSURBVFjDrZdLiBxVFIb/e289uqt6kkx6zIiIoKgLRReKuMhCcaOIAUEIiCCE4CIPggZ8kBjooPgM0TiYEUUjqBGchZqAQlyYRTA+kJiJQiJGMjN5zYzT3dP1rrr3HBeTjDGTSfc8Dvyruud89Z9z6kIJdBj31763MivsJXKuZYF6dak5++2mh7NOcsXVHq6sHbhOK/24kOJJMO4AE1vKygwZhxlKSHGKiD+RSu09vOXB43OCrHz96y6T2lsh+OmKXzFdlbLne2UopSAupBhjECcZgjDMgiiSxPhcK/nCr1sfOtcWcm/tq9uEsL4rl0vdK67pKVu2jUwTMk0wBBAzpBCQAnAtiZIlwWQwPlHPglZQAFj1Y23VwVkh92zbd59U+Kanp+p2L12mooKQ5AbcpuclS6LiKoRhxOfHzhXMcs3PtVV7Z0DufXH/LSzpSG9vr1/p6kIz0dDUrvx/IYXAsrJCkWc4e/Z0Zpgf+KX26A/TkNtrXziesY9Xq8tvWNZdVfVYg7hzwKVv3O3ZiKMWj46OTrq5fdOh1x5pSADwjdzo2nbv0u6qqkca2jCIMGcZAuqRhu8vEX7ZK2V2WgMAcXdtvyeKbPS662+osCohzMycHVweniNREoShoZO5KYobpciSh23bFq7rIUgNiLFghRkBlg2v7GlpiccsCHrcryzxUk3zmsNskeYGvt/lxVH4hMWEu9xSWaQFYQ7L1B6iGZ5bBoy+zWKiHiltFHpqeIsVhWaosg1iqlgg4wAAEYEXsV3EmNppJmExMFYUxfVSuIs6E0sI5FkBBhLJzH9laQxLSjBj0WQJgSJPweDTkknvS4JGbCuxKOt7UY4lEQfNnAu9TzLxN2nUdAQTLAEw8YIlAVgAkmDCSBL75eCutSeY+GTUqqNkqUVxUbIl4qgJo4vWzecrhyQAMJldYf1MXLLl1EIsYBZgoGwpRI2zMTPtGBhYbSQAlJF9lieRzNMIriVBzPOWawvoIkYaNC0u9IcAIAHgp75NLQl8ENbPZJ6jgAU48RyFqHEuZyE+Pda/vjENAQBD5s209Y+kPJlyM4+r3lUS0AWSyVEhpHnjYu1pyO+7N4ywwPvhxHDiuwo8j1b5rkQwMZIziYHBXetPzIAAgIV8exZOSMoieI6aU5vKtgR0jqw1JtiYbZfW/R/kSN+mcWbxdtwYjn1XTd9B7cQAfNdCWB/OhBR7jvWv/3tWCAAoO3ktjyZZJ0HHbsq2AooERVQXzPKly2vOgPz29jNNBr+e1IcSz5YAM4hmFzPDtyWS+lDK4N2DfU+dbgsBAFHyd+oszE3agt/GjWcrUBEjj5sQBb96pXpXhAzueDJi4u1p41TsuQpCiFln4bkKeXMoJeadg++tG+sYAgBBXOo3RRrruAnfkWDmGfIdCeQhiiQgQbxjtlqzQk59vCZlNluL5lDiORLyMjcA4DsKeXM4AfDKxa97ThAAqPaMfaR1Nq6jOiqOAhOm5TsKJg1QZGGRedY7V6tzVcjBWk1D0JZ8cigt2RJSimkXnqOgW8MxQLUTb6wN5g0BgGPV0c9BekTH41xx5YXrQ8FkTRgdpxU7ea9djbYQ1GokmJ43wUhWtgRcS04tQjAcw9CWw29tThYOAXD03XVfMps/TTTOy30blDZgiqxFK6p7OsnvCDJ1UD9LyUjORoPDkUQyPfdHbXW+qJCjfRsOwOAoNY4z6Xz01rHq3k5zO4ZMHTabYSIhJD87MLB64f8Ys8WdG/tfBljMJedfwY+s/2P4Pv8AAAAASUVORK5CYII="}}]);
//# sourceMappingURL=sunny-map-view-69231a7bb947dfc8eb5a.js.map