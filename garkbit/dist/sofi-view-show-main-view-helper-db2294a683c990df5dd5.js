(self.webpackJsonp=self.webpackJsonp||[]).push([[78],{123:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressView=t.ProgressModel=void 0;var n,r,i=l(o(1)),s=o(2),a=l(o(3));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.ProgressModel=n=function(){var e=(h(t,i.default.Model),t);function t(){return c(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.defaults={valuemin:0,valuemax:100,valuenow:0},e}.call(void 0),t.ProgressView=r=function(){var e=(h(t,s.View),t);function t(){return c(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.template=a.default.renderable(function(t){return a.default.div(".progress",function(){var e;return{valuemin:t.valuemin,valuemax:t.valuemax,valuenow:t.valuenow},e=Math.floor(t.valuenow/t.valuemax*100+.5),a.default.div(".progress-bar.progress-bar-striped",{role:"progressbar",style:"width: "+e+"%"},function(){return a.default.span({style:"color:black;"},t.valuenow+" of "+t.valuemax+".")})})}),e.prototype.modelEvents={change:"render"},e}.call(void 0),t.ProgressModel=n,t.ProgressView=r},553:function(e,t,o){"use strict";var r=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e};function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l,c,u,h,d,p,f,m,b,v,y,g,w,_,C,O;o(4),o(0),c=o(1),m=o(2),o(87),C=o(3),y=o(38),o(5);var P=o(31);P.make_field_input,P.make_field_select,o(40),w=o(88).default,h=o(190),b=o(554),_=o(555),g=o(557),f=c.Radio.channel("global"),v=c.Radio.channel("messages"),l=c.Radio.channel("sofi"),p=function(){var e=(a(t,y),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.mode="client",e}.call(void 0),u=function(){var e=(a(t,w),r(t,[{key:"onChildviewToolbarEntryClicked",value:function(){}},{key:"somethinChanged",value:function(){return console.log("somethinChanged")}}]),t);function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.childViewTriggers={"toolbar:entry:clicked":"toolbar:entry:clicked"},e.prototype.modelEvents={change:"somethinChanged"},e}.call(void 0),O=[{id:"main",label:"Main View",icon:".fa.fa-home"},{id:"curlist",label:"Current Comics",icon:".fa.fa-list"},{id:"scandb",label:"Scan Database for Comics",icon:".fa.fa-search.fa-spin"},{id:"upload",label:"Upload Comics",icon:".fa.fa-upload"}],d=function(){var e=(a(n,m.View),r(n,[{key:"_updateLocalComicsButton",value:function(){var e;return e=l.request("get-comics").length+" Local Comics",this.toolbarEntries.get("curlist").set("label",e)}},{key:"showToolbar",value:function(){var e;return this.toolbarEntries=new c.Collection(O),e=new u({collection:this.toolbarEntries}),this.showChildView("toolbar",e)}},{key:"showMainDoc",value:function(){var t,e,o=this;return(e=(t=f.request("main:app:get-document","sofi-main")).fetch()).done(function(){var e;return e=new b({model:t}),o.showChildView("body",e)}),e.fail(function(){return v.request("danger","failed to get document")})}},{key:"showLocalList",value:function(){var e,t,o;return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,n),t=l.request("get-comics"),e=new p(t.toJSON()),o=new h({collection:e}),this.showChildView("body",o)}},{key:"showUploadView",value:function(){var e;return e=new _,this.showChildView("body",e)}},{key:"showScannerView",value:function(){var e;return(e=new g).on("scan:completed",this.showLocalList),this.showChildView("body",e)}},{key:"onRender",value:function(){return l.request("get-comics").length&&this.showToolbar(),this.showMainDoc()}},{key:"onChildviewToolbarEntryClicked",value:function(e){var t;return this._updateLocalComicsButton(),"curlist"===(t=e.model.id)?this.showLocalList():"main"===t?this.showMainDoc():"scandb"===t?this.showScannerView():"upload"===t?this.showUploadView():v.request("danger","No good, dude.")}}]),n);function n(){i(this,n);var e=s(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return e.showLocalList=e.showLocalList.bind(e),e}return e.prototype.regions={toolbar:".toolbar",body:".body"},e.prototype.template=C.renderable(function(e){return C.div(".listview-header",function(){return C.text("CLZ XML to EBay File Exchange CSV")}),C.div(".toolbar"),C.div(".body")}),e}.call(void 0),e.exports=d},554:function(e,t,o){"use strict";var n,r,i,s;o(1),n=o(2),s=o(3),i=o(32),r=function(){var e=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.View),t);function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e.prototype.template=s.renderable(function(e){return s.article(".document-view.content.col-sm-8.col-sm-offset-2",function(){return s.div(".body",function(){return s.raw(i(e.content))})})}),e}.call(void 0),e.exports=r},555:function(e,t,o){"use strict";var n=function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e};function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}var c,u,h,d,p,f,m,b,v,y,g;o(4),v=o(0),u=o(1),h=o(2),o(87),g=o(3);var w=o(123);p=w.ProgressModel,f=w.ProgressView,y=o(556),u.Radio.channel("global"),d=u.Radio.channel("messages"),c=u.Radio.channel("sofi"),m=function(){var e=(a(o,h.Object),n(o,[{key:"initialize",value:function(e){return l(this,o),this.modelName=e.modelName||"clzcomic",this.modelId=e.modelId||"comic_id",this.dbPrefix="db:"+this.modelName,this.collection=c.request(this.dbPrefix+":collection"),this.currentItems=v.clone(e.items),this.progressModel=e.progressModel,this.progressModel.set("valuemax",this.currentItems.length),this.channel=this.getChannel(),this.channel.on(this.dbPrefix+":inserted",this.restore_items_now),this.channel.on(this.dbPrefix+":updated",this.restore_items_now),console.log("channel is",this.channel)}},{key:"insert_item",value:function(e){if(this.collection.length)throw new Error("We cannot insert!!!!");return this.channel.request(this.dbPrefix+":add",e)}},{key:"update_item",value:function(t){var e;if(1!==this.collection.length)throw new Error("Not unique error!!!");return e=this.collection.models[0],this.channel.request(this.dbPrefix+":updatePassed",e,t).fail(function(){var e;return e=t.series+" "+t.issue+" id:"+t.comic_id,d.request("danger","Unable to update "+e)})}},{key:"restore_item",value:function(e){var t,o=this;return this.collection.reset(),(t=this.collection.fetch({data:{where:function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},""+this.modelId,e[this.modelId])}})).fail(function(){return d.request("warning","There was a problem talking to the server")}),t.done(function(){return 1<o.collection.length&&d.request("warning",name+" is not unique!"),o.collection.length?o.update_item(e):o.insert_item(e)})}},{key:"restore_items",value:function(){var e,t;return l(this,o),t=this.progressModel.get("valuemax")-this.currentItems.length,this.progressModel.set("valuenow",t),this.currentItems.length?(e=this.currentItems.pop(),this.restore_item(e)):(d.request("success","Restoration Successful"),console.log("Stop Listening!!!!!!!!!!!!!!!!!!!!!!!"),this.channel.off(this.dbPrefix+":inserted"),this.channel.off(this.dbPrefix+":updated"),this.trigger("upload:completed"))}},{key:"restore_items_now",value:function(){return l(this,o),this.restore_items()}}]),o);function o(){i(this,o);var e=s(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments));return e.initialize=e.initialize.bind(e),e.restore_items=e.restore_items.bind(e),e.restore_items_now=e.restore_items_now.bind(e),e}return e.prototype.channelName="sofi",e}.call(void 0),b=function(){var e=(a(t,h.View),n(t,[{key:"initialize",value:function(e){return this.comics=c.request("get-comics")}},{key:"showUploadProgressBar",value:function(){var e;return this.uploadModel=new p,e=new f({model:this.uploadModel}),this.showChildView("uploadProgress",e)}},{key:"showCreateProgressBar",value:function(){var e;return this.createModel=new p,e=new f({model:this.createModel}),this.showChildView("createProgress",e)}},{key:"_createAttributes",value:function(e){var t,o,n,r,i,s,a;return t={comic_id:e.id,index:e.index,list_id:e.collectionstatus.$.listid,bpcomicid:e.bpcomicid,bpseriesid:e.bpseriesid,rare:!1,publisher:null!=e&&null!=(n=e.publisher)?n.displayname:void 0,releasedate:y(e.releasedate.date),seriesgroup:(null!=e&&null!=(r=e.seriesgroup)?r.displayname:void 0)||"UNGROUPED",series:e.mainsection.series.displayname,quantity:e.quantity,currentprice:e.currentpricefloat,content:e},(a=null!=e&&null!=(i=e.links)&&null!=(s=i.link)?s.url:void 0)&&(t.url=a),o=e.issue,e.issueext&&(t.issueext=e.issueext,(o=e.issue).endsWith(e.issueext)?o=o.split(e.issueext)[0]:console.warn("THIS IS BAD",o,e.issueext)),o=o||0,t.issue=o,t}},{key:"createComicDbItem",value:function(e){var t,o=this;return t=this._createAttributes(e),this.currentItems.push(t),this.createModel.set("valuenow",this.currentItems.length),this.currentItems.length!==this.comics.length?setTimeout(function(){return o.createAnotherItem()},5):(console.log("FINISHED CREATING"),this.uploadItems())}},{key:"createAnotherItem",value:function(){var e;if(this.comicClones.length)return e=this.comicClones.pop(),this.createComicDbItem(e)}},{key:"createItems",value:function(){var e,t;return this.comics,e=v.clone(this.comics),this.comicClones=e.toJSON(),this.createModel.set("valuemax",this.comicClones.length),this.createModel.set("valuenow",0),this.currentItems=[],t=this.comicClones.pop(),this.createComicDbItem(t)}},{key:"uploadItems",value:function(){return this._mgr=new m({modelName:"clzcomic",items:this.currentItems,progressModel:this.uploadModel,modelId:"comic_id"}),this._mgr.on("upload:completed",this.uploadCompleted),this._mgr.restore_items()}},{key:"uploadCompleted",value:function(){return l(this,t),console.log("UPLOAD COMPLETED!!!!!!!!!!!!"),delete this._mgr,this.currentItems=[],this.comicClones=void 0}},{key:"onRender",value:function(){return this.showCreateProgressBar(),this.showUploadProgressBar()}},{key:"onDomRefresh",value:function(){var e=this;return console.log("onDomRefresh UploadView"),setTimeout(function(){return e.createItems()},10)}}]),t);function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.uploadCompleted=e.uploadCompleted.bind(e),e}return e.prototype.regions={body:".body",createProgress:".create-progress",uploadProgress:".upload-progress"},e.prototype.template=g.renderable(function(e){return g.div(".listview-header",function(){return g.text("CLZ XML to EBay File Exchange CSV")}),g.div(".create-progress"),g.div(".upload-progress"),g.div(".body")}),e.prototype.events={"item:created":"create_items"},e}.call(void 0),e.exports=b},556:function(e,t,o){"use strict";var n,r,i=[].indexOf;n=o(111),r=function(e){if(e){if(0<=i.call(e,"/")){if(3===e.split("/").length)return n(e,"M/D/YYYY");throw"Couldn't parse "+e+"!",new Error("Couldn't parse "+e+"!")}return"string"==typeof e&&4===e.length?n("1/1/"+e,"M/D/YYYY"):n(e,"MMM YYYY")}return e=null},e.exports=r},557:function(e,t,o){"use strict";var n=function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e};function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}var c,u,h,d,p,f,m,b,v,y,g;o(4),y=o(0),u=o(1),d=o(2),o(87),g=o(3),o(90),o(7),o(111);var w=o(123);function _(){return i(this,_),s(this,(_.__proto__||Object.getPrototypeOf(_)).apply(this,arguments))}f=w.ProgressModel,m=w.ProgressView,u.Radio.channel("global"),p=u.Radio.channel("messages"),a(_,(c=u.Radio.channel("sofi")).request("db:clzcomic:collectionClass")),b=_,h=function(){var e=(a(t,d.Object),n(t,[{key:"initialize",value:function(e){return l(this,t),console.log("ComicScanner",e),this.modelName=e.modelName||"clzcomic",this.modelId=e.modelId||"comic_id",this.dbPrefix="db:"+this.modelName,this.collection=new b,this.currentItems=y.clone(e.items),this.progressModel=e.progressModel,this.progressModel.set("valuemax",this.currentItems.length),this.channel=this.getChannel(),this.on("comic:scanned",this.scanItems)}},{key:"scanItem",value:function(t){var e,o=this;return this.collection.reset(),(e=this.collection.fetch({data:{where:{comic_id:t.id}}})).fail(function(){return p.request("warning","There was a problem talking to the server")}),e.done(function(){var e;return e=c.request("get-comics").get(t.id),o.collection.length?e.set("inDatabase",!0):e.set("inDatabase",!1),o.trigger("comic:scanned")})}},{key:"scanItems",value:function(){var e,t;return t=this.progressModel.get("valuemax")-this.currentItems.length,this.progressModel.set("valuenow",t),this.currentItems.length?(e=this.currentItems.pop(),this.scanItem(e)):this.trigger("scan:completed")}}]),t);function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.initialize=e.initialize.bind(e),e}return e.prototype.channelName="sofi",e.prototype.events={"comic:scanned":"scanItems"},e}.call(void 0),v=function(){var e=(a(t,d.View),n(t,[{key:"initialize",value:function(e){return this.comics=c.request("get-comics"),this.currentItems=this.comics.toJSON()}},{key:"showScannerProgressBar",value:function(){var e;return this.progressModel=new f,e=new m({model:this.progressModel}),this.showChildView("scanProgress",e)}},{key:"scanItems",value:function(){return this._mgr=new h({modelName:"clzcomic",items:this.currentItems,progressModel:this.progressModel,modelId:"comic_id"}),this._mgr.on("scan:completed",this.scanCompleted),this._mgr.scanItems()}},{key:"scanCompleted",value:function(){return l(this,t),console.log("SCAN COMPLETED!!!!!!!!!!!!"),delete this._mgr,this.currentItems=[],this.comicClones=void 0,this.trigger("scan:completed")}},{key:"onRender",value:function(){return this.showScannerProgressBar(),this.scanItems()}}]),t);function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.scanCompleted=e.scanCompleted.bind(e),e}return e.prototype.regions={body:".body",scanProgress:".scan-progress"},e.prototype.template=g.renderable(function(e){return g.div(".listview-header",function(){return g.text("Compare CLZ XML to Database")}),g.div(".scan-progress"),g.div(".body")}),e}.call(void 0),e.exports=v}}]);
//# sourceMappingURL=sofi-view-show-main-view-helper-db2294a683c990df5dd5.js.map