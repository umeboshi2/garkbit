(self.webpackJsonp=self.webpackJsonp||[]).push([[72],{112:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressView=t.ProgressModel=void 0;var n,o,i=u(r(1)),c=u(r(2)),s=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.ProgressModel=n=function(){var e=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,i.default.Model),t}();return e.prototype.defaults={valuemin:0,valuemax:100,valuenow:0},e}.call(void 0),t.ProgressView=o=function(){var e=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,c.default.View),t}();return e.prototype.template=s.default.renderable(function(t){return s.default.div(".progress",function(){var e;return{valuemin:t.valuemin,valuemax:t.valuemax,valuenow:t.valuenow},e=Math.floor(t.valuenow/t.valuemax*100+.5),s.default.div(".progress-bar.progress-bar-striped",{role:"progressbar",style:"width: "+e+"%"},function(){return s.default.span({style:"color:black;"},t.valuenow+" of "+t.valuemax+".")})})}),e.prototype.modelEvents={change:"render"},e}.call(void 0),t.ProgressModel=n,t.ProgressView=o},449:function(e,t,r){"use strict";var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l,s,u,a,f,p,d,h,v,b,w,y,g,m,_,k,O,C,j,x,P,q,R,M,V,E,N=[].indexOf;C=r(0),r(4),u=r(1),w=r(2),r(82),E=r(3),R=r(83),r(5);var S=r(34);S.make_field_input,S.make_field_select,r(34).form_group_input_div;var T=r(20);V=T.modal_close_button;var A=r(112);_=A.ProgressModel,k=A.ProgressView,b=u.Radio.channel("global"),y=u.Radio.channel("messages"),l=u.Radio.channel("sofi"),a=b.request("main:app:BaseModalView"),s=b.request("main:app:AuthUnPaginated"),O=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,s),t}();return e.prototype.url="/api/dev/bapi/ebcomicworkspace",e}.call(void 0),q=new u.Collection,l.reply("get-csvrow-collection",function(){return q}),M=function(){var e,t,r;for(t in r=[],e=l.request("get-csv-header"))r.push(e[t]);return""+r.join(",")},P=function(){var e,t,r,n,o,i,c,s,u,a;for(e=l.request("get-csvrow-collection"),l.request("get-csv-header"),c=[M()],n=0,o=(s=e.models).length;n<o;n++){for(r in a=[],t=s[n].toJSON())u=(u=t[r]).split('"').join('""'),0<=N.call(u," ")&&(u='"'+u+'"'),a.push(u);i=a.join(","),c.push(i)}return c.join("\r\n")+"\r\n"},g=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,a),t}();return e.prototype.template=E.renderable(function(e){return e.mainsection,E.div(".modal-dialog",function(){return E.div(".modal-content",function(){return E.h4("Title: "+e.Title),E.div(".modal-body",function(){return E.h4("Description:"),E.hr(),E.div(".panel",function(){return E.raw(e.Description)})}),E.div(".modal-footer",function(){return E.ul(".list-inline",function(){return"btn.btn-default.btn-sm",E.li("#close-modal",function(){return V("Close","check")})})})})})}),e}.call(void 0),m=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,a),n(t,[{key:"templateContext",value:function(){var e;return(e=this.options).csvheader=l.request("get-csv-header"),e}}]),t}();return e.prototype.template=E.renderable(function(t){return E.div(".modal-dialog",function(){return E.div(".modal-content",function(){return E.h3("Title: "+t.Title),E.div(".modal-body",function(){return E.h4("CSV Row:"),E.hr(),E.div(".panel",function(){return E.dl(".dl-horizontal",function(){return Object.keys(t).forEach(function(e){return E.dt(t.csvheader[e]),E.dd(t[e])})})})}),E.div(".modal-footer",function(){return E.ul(".list-inline",function(){return E.li("#close-modal",function(){return V("Close","check")})})})})})}),e}.call(void 0),x=["max-width:0","overflow:hidden","text-overflow:ellipsis","white-space:nowrap"].join(";")+";",v=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,w.View),n(t,[{key:"templateContext",value:function(){var e;return(e=this.options).csvheader=l.request("get-csv-header"),e}},{key:"show_row",value:function(){var e;return e=new m({model:this.model}),b.request("show-modal",e)}},{key:"show_description",value:function(){var e;return e=new g({model:this.model}),b.request("show-modal",e)}}]),t}();return e.prototype.tagName="tr",e.prototype.template=E.renderable(function(t){return E.td(function(){return E.div(".btn-group.btn-group-justified",function(){return E.div(".show-desc-button.btn.btn-default.btn-xs",function(){return E.i(".fa.fa-eye")}),E.div(".show-row-button.btn.btn-default.btn-xs",function(){return E.i(".fa.fa-list")})})}),Object.keys(t.csvheader).forEach(function(e){return E.td({style:x},t[e])})}),e.prototype.ui={desc_btn:".show-desc-button",row_btn:".show-row-button"},e.prototype.events={"click @ui.desc_btn":"show_description","click @ui.row_btn":"show_row"},e}.call(void 0),h=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,w.CollectionView),t}();return e.prototype.tagName="tbody",e.prototype.childView=v,e}.call(void 0),j=["table","table-striped","table-bordered","table-hover","table-condensed"],d=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,w.View),n(t,[{key:"templateContext",value:function(){var e;return(e=this.options).ebcfg_collection=l.request("db:ebcfg:collection"),e.ebdsc_collection=l.request("db:ebdsc:collection"),e.csvheader=l.request("get-csv-header"),e}},{key:"onRender",value:function(){var e,t;return e=l.request("get-csvrow-collection"),t=new h({collection:e}),this.showChildView("body",t)}}]),t}();return e.prototype.tagName="table",e.prototype.className=j.join(" "),e.prototype.template=E.renderable(function(t){return E.div(".table-responsive",function(){return E.table("."+j.join("."),function(){return E.thead(function(){return E.tr(".info",function(){return E.td(function(){return E.i(".fa.fa-eye.fa-3x")}),Object.keys(t.csvheader).forEach(function(e){return E.th(t.csvheader[e])})})}),E.tbody()})})}),e.prototype.regions={body:{el:"tbody",replaceElement:!0}},e}.call(void 0),p=function(){var e=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.initialize=e.initialize.bind(e),e}return c(t,w.Object),n(t,[{key:"initialize",value:function(e){return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,t),this.currentItems=C.clone(e.items),this.progressModel=e.progressModel,this.progressModel.set("valuemax",this.currentItems.length),this.channel=this.getChannel(),this.rowOptions={action:e.action,cfg:e.cfg,desc:e.dsc}}},{key:"createCsvRow",value:function(e){var t,r,n=this;return r=C.extend(this.rowOptions,{comic:e}),t=l.request("create-csv-row-object",r),this.currentRows.push(t),this.progressModel.set("valuenow",this.currentRows.length),this.currentRows.length!==this.currentItems.length?setTimeout(function(){return n.createAnotherRow()},5):this.trigger("csv:rows:created")}},{key:"createAnotherRow",value:function(){var e;if(this.currentClones.length)return e=this.currentClones.pop(),this.createCsvRow(e)}},{key:"createCsvRows",value:function(){return this.currentClones=C.clone(this.currentItems),this.progressModel.set("valuemax",this.currentClones.length),this.progressModel.set("valuenow",0),this.currentRows=[],this.createAnotherRow()}}]),t}();return e.prototype.channelName="sofi",e}.call(void 0),f=function(){var e=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,w.View),n(t,[{key:"templateContext",value:function(){var e;return(e=this.options).ebcfg_collection=l.request("db:ebcfg:collection"),e.ebdsc_collection=l.request("db:ebdsc:collection"),e.workspace=l.request("locals:get","currentCsvWorkspace"),e}},{key:"open_fileexchange_tab",value:function(){return window.open("http://bulksell.ebay.com/ws/eBayISAPI.dll?FileExchangeUploadForm","_blank")}},{key:"make_csv_file",value:function(){var e,t,r,n;return P(),t=new Date,n=R(t,"yyyy-mm-dd-HH:MM:ss"),e=this.ui.filename_input.val()||"export-"+n+".csv",r={type:"data:text/csv;charset=utf-8",data:P(),el_id:"exported-csv-anchor",filename:e},b.request("export-to-file",r)}},{key:"createCsvRows",value:function(){var e,t,r=this;return this.currentRows=[],l.request("locals:get","currentCsvAction"),l.request("locals:get","currentCsvCfg"),l.request("locals:get","currentCsvDsc"),e=l.request("locals:get","currentCsvWorkspace"),b.request("main:app:AuthUnPaginated"),(t=new O).fetch({data:{withRelated:["comic","comic.photos"],where:{name:e}}}).done(function(){return r.parseRows(t)})}},{key:"parseRows",value:function(e){var t,r;return e.toJSON(),r=[],e.toJSON().forEach(function(e){return r.push(e.comic)}),(t=new p({items:r,progressModel:this.createModel,action:l.request("locals:get","currentCsvAction"),cfg:l.request("locals:get","currentCsvCfg"),dsc:l.request("locals:get","currentCsvDsc"),workspace:l.request("locals:get","currentCsvWorkspace")})).createCsvRows(),t.on("csv:rows:created",function(){return l.request("get-csvrow-collection").set(t.currentRows)})}},{key:"showCreateProgressBar",value:function(){var e;return this.createModel=new _,e=new k({model:this.createModel}),this.showChildView("createProgress",e)}},{key:"onRender",value:function(){var e,t,r;return this.showCreateProgressBar(),t=l.request("get-comic-image-urls"),Object.keys(t).length||("No pictures attached, please view comics, then create csv",y.request("warning","No pictures attached, please view comics, then create csv")),this.createCsvRows(),e=l.request("get-csvrow-collection"),r=new d({collection:e}),this.showChildView("body",r)}}]),t}();return e.prototype.regions={createProgress:".create-progress",body:".body"},e.prototype.template=E.renderable(function(e){var t,r;return r=new Date,t="export-"+R(r,"mmddHHMM")+".csv",E.div(".listview-header",function(){return E.text("Preview "+e.workspace+" CSV")}),E.div(".fileexchange-button.btn.btn-default","Ebay Upload"),E.div(".mkcsv-button.btn.btn-default","Create CSV"),E.input(".form-control",{value:t,name:"csvfilename"}),E.div(".create-progress"),E.div(".body")}),e.prototype.ui={mkcsv_btn:".mkcsv-button",filename_input:"input[name='csvfilename']",fileexchange_btn:".fileexchange-button"},e.prototype.events={"click @ui.mkcsv_btn":"make_csv_file","click @ui.fileexchange_btn":"open_fileexchange_tab"},e}.call(void 0),e.exports=f}}]);
//# sourceMappingURL=sofi-view-show-preview-csv-view-helper-a269298f5774d6287733.js.map