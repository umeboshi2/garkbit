(self.webpackJsonp=self.webpackJsonp||[]).push([[85],{571:function(t,e,o){"use strict";var n=function(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t};function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=d(o(1)),a=o(2),u=d(o(3)),c=(d(o(7)),d(o(252))),l=d(o(5)),s=d(o(572));function d(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")}var p,h,A,g,b,w,y;o(253),h=i.default.Radio.channel("global"),g=i.default.Radio.channel("sunny"),p=i.default.Radio.channel("gps"),h.request("main:app:AuthModel"),h.request("main:app:AuthCollection"),b="height:20em;",u.default.renderable(function(t){return u.default.div(function(){return u.default.h2("Map View"),u.default.div(".checkbox",function(){return u.default.label(function(){return u.default.input("#watch-map",{type:"checkbox"}),u.default.text("watch")})}),u.default.div("#map-view",{style:b})})}),w=u.default.renderable(function(t){return u.default.div(".row",function(){return u.default.h2("Map View"),u.default.div(".checkbox",function(){return u.default.label(function(){return u.default.input("#watch-map",{type:"checkbox"}),u.default.text("watch")})})}),u.default.div(".row",function(){return u.default.div("#map-view.col-md-4",{style:b})})}),y=c.default.icon({iconUrl:s.default}),A=function(){var t=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(o,a.View),n(o,[{key:"watch_button",value:function(t){return console.log("somwthing happened",t),t.target.checked?(console.log("Watch me!!!!",this.ui.map),this.Map.locate({watch:!0})):(console.log("Stop watching me....",this.ui.map),this.Map.locate({watch:!1}))}},{key:"addYardMarkers",value:function(){var i,t,a=this;return t=g.request("yard-collection"),(i=t).fetch().done(function(){var t,e,o,n,r;for(console.log("FULLYARDS",i),r=[],t=0,e=(n=i.models).length;t<e;t++)o=n[t],r.push(function(t){var e,o,n;if((e=t.attributes.geoposition).latitude)return o=[e.latitude,e.longitude],(n=c.default.marker(o,{icon:y,url:"#sunny/yards/view/"+e.id,title:t.attributes.name})).on("click",function(){return(0,l.default)("#sunny/yards/view/"+t.id)}),n.addTo(a.Map)}(o));return r})}},{key:"addPositionMarkers",value:function(){var u,l=this;return(u=p.request("position-collection")).fetch().done(function(){var t,e,o,n,r,i,a;for(a=[],e=0,o=(i=u.models).length;e<o;e++)(t=i[e].attributes).latitude?(n=[t.latitude,t.longitude],r=c.default.marker(n,{icon:y,url:"#sunny/yards/view/"+t.id}),console.log("marker location",n,t.id),a.push(r.addTo(l.Map))):a.push(void 0);return a})}},{key:"onDomRefresh",value:function(){var t;return this.Map=c.default.map("map-view"),this.Map.on("moveend",this.getCenter),this.Map.on("locationerror",this.onLocationError),this.Map.locate({setView:!0,watch:!1,enableHighAccuracy:!0}),(t=c.default.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png")).addTo(this.Map),console.log("MAP, LAYER",this.Map,t),this.addYardMarkers()}},{key:"getCenter",value:function(t){return f(this,o),console.log(this.Map.getCenter())}},{key:"onLocationError",value:function(t){var e;if(f(this,o),console.log("unable to get location",t),!this.first_location_error)return console.log("initialize map location"),e=[31.33,-89.28],this.Map.setView(e,13),this.first_location_error=!0}}]),o);function o(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments));return t.getCenter=t.getCenter.bind(t),t.onLocationError=t.onLocationError.bind(t),t}return t.prototype.template=w,t.prototype.ui={map:"#map-view",watch:"#watch-map"},t.prototype.events={"change @ui.watch":"watch_button"},t.prototype.defaultMapStyle=b,t.prototype.fsMapStyle="position: absolute; top: 0; right: 0; bottom: 0; left: 0;",t.prototype.first_location_error=!1,t}.call(void 0),t.exports=A},572:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUlSURBVFjDrZdLiBxVFIb/e289uqt6kkx6zIiIoKgLRReKuMhCcaOIAUEIiCCE4CIPggZ8kBjooPgM0TiYEUUjqBGchZqAQlyYRTA+kJiJQiJGMjN5zYzT3dP1rrr3HBeTjDGTSfc8Dvyruud89Z9z6kIJdBj31763MivsJXKuZYF6dak5++2mh7NOcsXVHq6sHbhOK/24kOJJMO4AE1vKygwZhxlKSHGKiD+RSu09vOXB43OCrHz96y6T2lsh+OmKXzFdlbLne2UopSAupBhjECcZgjDMgiiSxPhcK/nCr1sfOtcWcm/tq9uEsL4rl0vdK67pKVu2jUwTMk0wBBAzpBCQAnAtiZIlwWQwPlHPglZQAFj1Y23VwVkh92zbd59U+Kanp+p2L12mooKQ5AbcpuclS6LiKoRhxOfHzhXMcs3PtVV7Z0DufXH/LSzpSG9vr1/p6kIz0dDUrvx/IYXAsrJCkWc4e/Z0Zpgf+KX26A/TkNtrXziesY9Xq8tvWNZdVfVYg7hzwKVv3O3ZiKMWj46OTrq5fdOh1x5pSADwjdzo2nbv0u6qqkca2jCIMGcZAuqRhu8vEX7ZK2V2WgMAcXdtvyeKbPS662+osCohzMycHVweniNREoShoZO5KYobpciSh23bFq7rIUgNiLFghRkBlg2v7GlpiccsCHrcryzxUk3zmsNskeYGvt/lxVH4hMWEu9xSWaQFYQ7L1B6iGZ5bBoy+zWKiHiltFHpqeIsVhWaosg1iqlgg4wAAEYEXsV3EmNppJmExMFYUxfVSuIs6E0sI5FkBBhLJzH9laQxLSjBj0WQJgSJPweDTkknvS4JGbCuxKOt7UY4lEQfNnAu9TzLxN2nUdAQTLAEw8YIlAVgAkmDCSBL75eCutSeY+GTUqqNkqUVxUbIl4qgJo4vWzecrhyQAMJldYf1MXLLl1EIsYBZgoGwpRI2zMTPtGBhYbSQAlJF9lieRzNMIriVBzPOWawvoIkYaNC0u9IcAIAHgp75NLQl8ENbPZJ6jgAU48RyFqHEuZyE+Pda/vjENAQBD5s209Y+kPJlyM4+r3lUS0AWSyVEhpHnjYu1pyO+7N4ywwPvhxHDiuwo8j1b5rkQwMZIziYHBXetPzIAAgIV8exZOSMoieI6aU5vKtgR0jqw1JtiYbZfW/R/kSN+mcWbxdtwYjn1XTd9B7cQAfNdCWB/OhBR7jvWv/3tWCAAoO3ktjyZZJ0HHbsq2AooERVQXzPKly2vOgPz29jNNBr+e1IcSz5YAM4hmFzPDtyWS+lDK4N2DfU+dbgsBAFHyd+oszE3agt/GjWcrUBEjj5sQBb96pXpXhAzueDJi4u1p41TsuQpCiFln4bkKeXMoJeadg++tG+sYAgBBXOo3RRrruAnfkWDmGfIdCeQhiiQgQbxjtlqzQk59vCZlNluL5lDiORLyMjcA4DsKeXM4AfDKxa97ThAAqPaMfaR1Nq6jOiqOAhOm5TsKJg1QZGGRedY7V6tzVcjBWk1D0JZ8cigt2RJSimkXnqOgW8MxQLUTb6wN5g0BgGPV0c9BekTH41xx5YXrQ8FkTRgdpxU7ea9djbYQ1GokmJ43wUhWtgRcS04tQjAcw9CWw29tThYOAXD03XVfMps/TTTOy30blDZgiqxFK6p7OsnvCDJ1UD9LyUjORoPDkUQyPfdHbXW+qJCjfRsOwOAoNY4z6Xz01rHq3k5zO4ZMHTabYSIhJD87MLB64f8Ys8WdG/tfBljMJedfwY+s/2P4Pv8AAAAASUVORK5CYII="}}]);
//# sourceMappingURL=sunny-map-view-5a0e26de48f8e6bb7493.js.map