(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{372:function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u,s,l,c,p,f,d,h,_=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};s=n(0),n(1),n(76),h=n(2),d=n(5).default;var m=n(30);m.make_field_input,m.make_field_select,s.Radio.channel("global"),c=s.Radio.channel("messages"),u=s.Radio.channel("ebcsv"),f=h.renderable(function(e){return h.article(".document-view.content",function(){return h.div(".body",function(){return h.div(".card",function(){return h.div(".card-header",function(){return h.text("Drop an xml file, or use the "),h.button(".sample-comics-button.btn.btn-default","Example data.")}),h.div(".card-body",function(){return h.div(".parse-btn.btn.btn-default",{style:"display:none"},function(){return h.text("Parse Dropped File")}),h.input(".xml-file-input.input",{type:"file"}),h.span(".parse-chosen-button.btn.btn-default",{style:"display:none"},function(){return h.text("Parse input file.")})})})})})}),p=function(){var e=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,s.Model),r(t,[{key:"fetch",value:function(e){return(e=e||{}).dataType="text",function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fetch",this).call(this,e)}},{key:"parse",value:function(e,t){return{content:e}}}]),t}();return e.prototype.url="/assets/documents/sample-comics.xml",e}.call(void 0),l=function(){var e=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.successfulParse=e.successfulParse.bind(e),e.xmlReaderOnLoad=e.xmlReaderOnLoad.bind(e),e}return a(t,s.Marionette.View),r(t,[{key:"file_input_clicked",value:function(e){return console.log("file_input_clicked",e),this.ui.file_input.val(null),this.ui.chosen_btn.hide()}},{key:"file_input_changed",value:function(e){return console.log("file_input_changed",e),this.ui.chosen_btn.show()}},{key:"handle_drop",value:function(e){var t;return e.preventDefault(),this.$el.css("border","0px"),t=e.originalEvent.dataTransfer.files[0],this.ui.status_msg.text("File: "+t.name),this.droppedFile=t,this.ui.parse_btn.show()}},{key:"handle_dragOver",value:function(e){return e.preventDefault(),e.stopPropagation()}},{key:"handle_dragEnter",value:function(e){return e.stopPropagation(),e.preventDefault(),this.$el.css("border","2px dotted")}},{key:"successfulParse",value:function(){return _(this,t),this.ui.status_msg.text("Parse Successful"),d("#ebcsv")}},{key:"parse_chosen_xml",value:function(){var e,t;return this.ui.status_msg.text("Reading xml file..."),this.ui.file_input.val(),this.ui.file_input,e=this.ui.file_input[0].files[0],(t=new FileReader).onload=this.xmlReaderOnLoad,t.readAsText(e),this.ui.parse_btn.hide()}},{key:"xmlReaderOnLoad",value:function(e){var n;return _(this,t),n=e.target.result,this.ui.status_msg.text("Parsing xml....."),u.request("parse-comics-xml",n,this.successfulParse)}},{key:"parse_xml",value:function(){var e;return this.ui.status_msg.text("Reading xml file..."),(e=new FileReader).onload=this.xmlReaderOnLoad,e.readAsText(this.droppedFile),this.ui.parse_btn.hide()}},{key:"parse_sample_xml",value:function(){var e,t,n=this;return t=(e=new p).fetch(),this.ui.status_msg.text("Retrieving xml...."),t.done(function(){var t;return n.ui.status_msg.text("Parsing xml...."),t=e.get("content"),u.request("parse-comics-xml",t,n.successfulParse)}),t.fail(function(){return n.ui.status_msg.text("Something failed."),c.danger("Failed to parse sample comics")})}}]),t}();return e.prototype.template=f,e.prototype.droppedFile=null,e.prototype.ui={status_msg:".card-header",file_input:".xml-file-input",parse_btn:".parse-btn",chosen_btn:".parse-chosen-button",sampleComicsBtn:".sample-comics-button"},e.prototype.events={dragover:"handle_dragOver",dragenter:"handle_dragEnter",drop:"handle_drop","click @ui.parse_btn":"parse_xml","click @ui.file_input":"file_input_clicked","change @ui.file_input":"file_input_changed","click @ui.chosen_btn":"parse_chosen_xml","click @ui.sampleComicsBtn":"parse_sample_xml"},e}.call(void 0),e.exports=l}}]);
//# sourceMappingURL=ebcsv-view-upload-xml-view-1ba3f5d147d8b79e9cad.js.map