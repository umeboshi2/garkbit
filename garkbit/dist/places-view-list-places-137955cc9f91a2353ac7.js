(self.webpackJsonp=self.webpackJsonp||[]).push([[73],{1117:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),u=l(r(6)),s=l(r(376));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n=function(){var e=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),i(t,[{key:"className",value:function(){return"list-group-item location-item row"}}]),t}(a.View);return e.prototype.template=u.default.renderable((function(e){return u.default.span(".mr-auto",(function(){return u.default.a({href:"#places/view/"+e.id},e.name)}))})),e.prototype.tagName="li",e}.call(void 0),o=function(){var e=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),i(t,[{key:"ui",value:function(){return{itemList:".places-container",paginateBar:".paginate-bar"}}}]),t}(s.default);return e.prototype.ItemView=n,e.prototype.template=u.default.renderable((function(){return u.default.div(".listview-header",(function(){return u.default.text("Your Places")})),u.default.hr(),u.default.div(".paginate-bar"),u.default.div(".places-container")})),e}.call(void 0),t.default=o},1119:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(3),a=l(r(6)),u=l(r(389));r(642),r(1120),r(1124),r(1143),r(1144),r(1145);var s=l(r(573));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d,p,h,g;p=o.Radio.channel("global"),g=o.Radio.channel("messages"),d=o.Radio.channel("places"),h=function(){var e=function(e){function t(){c(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.locationSuccess=e.locationSuccess.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"initialize",value:function(){return this.currentMarkers=this.getOption("currentMarkers")||[],this.currentRadius=this.getOption("currentRadius")||0}},{key:"onDomRefresh",value:function(){var e,t=this;return console.log("onDomRefresh"),this.getLocation(),e={animate:"fast",classes:{"ui-slider":"highlight"},disabled:!1,max:1500,min:0,step:10,change:function(e,r){return console.log("ui.value",r.value),t.setRadius(r.value),t.ui.radiusLabel.text("("+r.value+" meters)")}},this.ui.radiusSlider.slider(e),console.log("@ui.radiusSlider",this.ui.radiusSlider)}},{key:"onRender",value:function(){return console.log("onRender")}},{key:"getLocation",value:function(){var e;return e={success:this.locationSuccess,error:this.locationError},p.request("main:app:getCurrentPosition",e)}},{key:"showMap",value:function(){var e,t,r,n;return r=new s.default({mapWidth:"30rem"}),this.showChildView("mapContainer",r),console.log("view",r),n=13,t=[(e=this.currentPosition).latitude,e.longitude],e.accuracy>150&&(n=13),r.Map.setView(t,n),this.addMarkers({map:r.Map,radius:this.currentRadius})}},{key:"locationSuccess",value:function(e){return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,t),console.log("locationSuccess",e),e=e.coords,this.currentPosition=e,console.log("finish rendering map"),this.showMap()}},{key:"locationError",value:function(){return g.request("warning","Unable to get current location.")}},{key:"addMarkers",value:function(e){var t,r=this;return t=d.request("db:userlocation:collection"),console.log("addMarkers",this.currentPosition),t.fetch({data:{all:!0,peer:{latitude:this.currentPosition.latitude,longitude:this.currentPosition.longitude,radius:this.currentRadius}}}).done((function(){var n;return n=r.getRegion("mapContainer").currentView.Map,console.log("map is",n),e={models:t.models,map:n},r.setMarkers(e)}))}},{key:"setMarkers",value:function(e){var t,r,n,o,i,a=this;for(console.log("setMarkers options",e),i=[],t=0,r=(o=e.models).length;t<r;t++)n=o[t],i.push(function(t){var r,n,o;return r=[(n=t.get("location")).latitude,n.longitude],(o=u.default.marker(r,{icon:u.default.icon.glyph({prefix:"fa",glyph:"circle"}),title:t.get("name")})).on("click",(function(){return console.log("marker clicked",o,o.title)})),o.addTo(e.map),a.currentMarkers.push(o)}(n));return i}},{key:"setRadius",value:function(e){var t,r=this;return this.currentRadius=e,this.currentMarkers.forEach((function(e){return r.getRegion("mapContainer").currentView.Map.removeLayer(e)})),t=d.request("db:userlocation:collection"),console.log("addMarkers",this.currentPosition),t.fetch({data:{all:!0,peer:{latitude:this.currentPosition.latitude,longitude:this.currentPosition.longitude,radius:this.currentRadius}}}).done((function(){var e;return e=r.getRegion("mapContainer").currentView.Map,r.setMarkers({models:t.models,map:e})}))}}]),t}(i.View);return e.prototype.template=a.default.renderable((function(){return a.default.div(".listview-header","All Locations"),a.default.div(".mb-2.radius-slider"),a.default.div(".radius-label"),a.default.div(".col.map-container")})),e.prototype.ui={mapContainer:".map-container",radiusSlider:".radius-slider",radiusLabel:".radius-label"},e.prototype.regions={mapContainer:"@ui.mapContainer"},e}.call(void 0),t.default=h}}]);
//# sourceMappingURL=places-view-list-places-137955cc9f91a2353ac7.js.map