(self.webpackJsonp=self.webpackJsonp||[]).push([[84],{554:function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();var r,d,a,i,f,l,c,s,p,u,h,v,w;r=n(4),a=n(1),l=n(2),p=n(10),h=n(101),n(169),n(170),f=a.Radio.channel("global"),d=a.Radio.channel("tvmaze"),a.Radio.channel("hubby"),w=n(3),c=w.renderable(function(){return w.div(".listview-header","Episodes"),w.div(".loading",function(){return w.h2(function(){return w.i(".fa.fa-spinner.fa-spin"),w.text("Loading Episodes")})}),w.div(".maincalendar")}),v=function(e,t){return e.url="#tvmaze/shows/view/"+e.showId,t.css({cursor:"pointer","font-size":"0.9em","font-family":"Rambla"})},u=function(e){var t,n;return n=r(".loading"),t=r(".fc-toolbar"),e?(n.show(),t.hide()):(n.hide(),t.show())},s=function(e,t,n,o){var a,r,i,l,c,s,u;return d.request("get-local-episode-model"),a=d.request("get-local-episode-collection"),u=(r=f.request("main:app:dbConn","tvmaze")).getSchema().table("TVMazeEpisode"),l=[],s=(window.startMoment=e).toDate(),i=t.toDate(),l.push(u.airdate.gte(e)),l.push(u.airdate.lte(t)),c=r.select().from(u).where(p.op.and(u.airdate.gte(e.toDate()),u.airdate.lte(t.toDate()))),console.log("Q",c,s,i),c=c.exec(),console.log("Q",c),c.then(function(e){var t,n,r;return console.log("RESULTS",e),(t=new a).set(e),n=t.toJSON(),console.log("collection",t),r=[],n.forEach(function(e){var t,n,o;return t=h(e.airdate),o=e.runtime||30,n={id:e.id,showId:e.show_id,title:e.name,allDay:!1,start:t,end:t.add(o,"minutes"),url:"#tvmaze/shows/view/"+e.show_id},r.push(n)}),o(r)})},i=function(){var e=function(e){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return e.calendarViewRender=e.calendarViewRender.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,l.View),o(n,[{key:"onBeforeDestroy",value:function(){return this.ui.calendar.fullCalendar("destroy"),console.log("calendar destroyed")}},{key:"calendarViewRender",value:function(e,t){return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,n),d.request("maincalendar:set-date",this.ui.calendar)}},{key:"onDomRefresh",value:function(){var e,t,o=this;return e=function(e){var t,n;return o.options.minicalendar?(t={layout:o.options.layout,region:"episode",id:e.id},d.request("view-episode",t)):(n=e.url,console.log("EVENT URL",e,n),a.history.navigate(n,{trigger:!0}))},t=d.request("maincalendar:get-date"),this.ui.calendar.fullCalendar({defaultDate:t,header:{left:"prevYear, nextYear",center:"title",right:"prev, next"},theme:!1,defaultView:"month",eventSources:[{events:s}],eventRender:v,viewRender:this.calendarViewRender,loading:u,eventClick:e}),console.log("we should either be fetching events, or refetching")}}]),n}();return e.prototype.template=c,e.prototype.ui={calendar:".maincalendar",loading:".loading",header:".fc-toolbar",daytop:".fc-day-top"},e.prototype.options={minicalendar:!1,layout:!1},e}.call(void 0),e.exports=i}}]);
//# sourceMappingURL=tvmaze-view-calendar-516910203879ebe29383.js.map