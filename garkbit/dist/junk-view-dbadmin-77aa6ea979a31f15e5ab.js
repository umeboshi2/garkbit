(self.webpackJsonp=self.webpackJsonp||[]).push([[58],{1056:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=(d(n(7)),n(1)),r=n(3),a=d(n(6)),u=d(n(581)),l=d(n(236));function d(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c,b,h,v,y,w;h=o.Radio.channel("global"),y=o.Radio.channel("messages"),a.default.renderable((function(t){return a.default.div(".listview-list-entry",(function(){return a.default.h2(t.name),a.default.div(".btn-group",(function(){return a.default.button(".view.btn.btn-success",{type:"button"},"View"),a.default.button(".export.btn.btn-primary",{type:"button"},"Export"),a.default.button(".import.btn.btn-info",{type:"button"},"Import")})),a.default.div(".dbview")}))})),w=a.default.renderable((function(t){return a.default.div(".card",(function(){return a.default.div(".card-header",(function(){return a.default.h2(t.name)})),a.default.div(".card-body",(function(){return a.default.div(".file-status",(function(){return a.default.text("Drop a .json exported database to import.")})),a.default.button(".view.btn.btn-success",{type:"button"},"View"),a.default.button(".export.btn.btn-primary",{type:"button"},"Export"),a.default.div(".import.btn.btn-info",{type:"button",style:"display:none"},(function(){return a.default.text("Import Database")})),a.default.input(".db-file-input.input",{type:"file"}),a.default.button(".import-chosen.btn.btn-info",{style:"display:none"},(function(){return a.default.text("Import input file")})),a.default.div(".dbview")}))}))})),c=function(){var t=function(t){function e(){return f(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),e}(r.View);return t.prototype.behaviors=[l.default],t.prototype.template=a.default.renderable((function(){return a.default.div(".jsonview")})),t}.call(void 0),b=function(){var t=function(t){function e(){f(this,e);var t=p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.fileReaderOnLoad=t.fileReaderOnLoad.bind(t),t}return s(e,t),i(e,[{key:"fileInputClicked",value:function(){return this.ui.fileInput.val(null),this.ui.importChosenButton.hide()}},{key:"fileInputChanged",value:function(){return this.ui.importChosenButton.show()}},{key:"handleDrop",value:function(){var t,e;return event.preventDefault(),this.$el.css("border","0px"),t=event.originalEvent.dataTransfer.files[0],this.droppedFile=t,e="File: "+t.name,this.ui.fileStatus.text(e),this.ui.importButton.show()}},{key:"handleDragOver",value:function(t){return t.preventDefault(),t.stopPropagation()}},{key:"handleDragEnter",value:function(t){return t.stopPropagation(),t.preventDefault(),this.$el.css("border","2px dotted")}},{key:"handleDragExit",value:function(t){return t.stopPropagation(),t.preventDefault(),this.$el.css("border","0px")}},{key:"_exportDatabase",value:function(){return this.model.get("conn").export()}},{key:"viewDatabase",value:function(){var t=this;return this._exportDatabase().then((function(e){var n;return n=new c({model:new o.Model(e)}),t.showChildView("dbView",n),t.ui.viewButton.hide()}))}},{key:"exportDatabase",value:function(){var t=this;return this._exportDatabase().then((function(e){var n,i,o;return i=t.model.get("name"),o={type:"data:text/json;charset=utf-8",data:JSON.stringify(e),filename:i+"-idb.json"},n=new Blob([o.data],{type:o.type}),u.default.saveAs(n,o.filename),y.request("primary","Exported Database "+i)}))}},{key:"fileReaderOnLoad",value:function(t){var n,i=this;return function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")}(this,e),n=JSON.parse(t.target.result),this.ui.fileStatus.text("Database file loaded, now importing...."),this.model.get("conn").import(n).then((function(){return i.viewDatabase()}))}},{key:"importDatabase",value:function(){var t;return y.request("info","Import Database "+this.model.get("name")),this.ui.fileStatus.text("Reading dabase file....."),(t=new FileReader).onload=this.fileReaderOnLoad,t.readAsText(this.droppedFile),this.ui.importButton.hide()}}]),e}(r.View);return t.prototype.template=w,t.prototype.ui={viewButton:".view",exportButton:".export",importButton:".import",dbView:".dbview",fileInput:".db-file-input",importChosenButton:".import-chosen",fileStatus:".file-status"},t.prototype.regions={dbView:"@ui.dbView"},t.prototype.events={dragover:"handleDragOver",dragenter:"handleDragEnter",dragexit:"handleDragExit",drop:"handleDrop","click @ui.viewButton":"viewDatabase","click @ui.exportButton":"exportDatabase","click @ui.importButton":"importDatabase","click @ui.importChosenButton":"importChosenFile","click @ui.fileInput":"fileInputClicked","change @ui.fileInput":"fileInputChanged"},t}.call(void 0),v=function(){var t=function(t){function e(){return f(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),i(e,[{key:"onRender",value:function(){var t,e,n,i=this;return t=h.request("main:app:object"),e=t.getState("dbConn"),this.collection=new o.Collection,n=new r.CollectionView({collection:this.collection,childView:b}),this.showChildView("body",n),Object.keys(e).forEach((function(t){return i.collection.add({id:t,name:t,conn:e[t]})}))}}]),e}(r.View);return t.prototype.regions={body:".body"},t.prototype.template=a.default.renderable((function(){return a.default.div(".listview-header.text-center",(function(){return a.default.text("Indexed Database Admin")})),a.default.div(".body")})),t}.call(void 0),e.default=v}}]);
//# sourceMappingURL=junk-view-dbadmin-77aa6ea979a31f15e5ab.js.map