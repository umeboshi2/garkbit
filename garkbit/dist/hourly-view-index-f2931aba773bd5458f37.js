(self.webpackJsonp=self.webpackJsonp||[]).push([[48],{468:function(t,e,n){"use strict";var o=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t};function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u,i,a,l,s,f,c,d,p,h=k(n(1)),w=k(n(2)),y=k(n(3)),v=(k(n(32)),k(n(111))),b=(k(n(5)),k(n(469)));function k(t){return t&&t.__esModule?t:{default:t}}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}h.default.Radio.channel("global"),i=h.default.Radio.channel("messages"),h.default.Radio.channel("hourly"),f=y.default.renderable(function(t){return y.default.div(".row.listview-list-entry",function(){return y.default.text("You are not a worker.")})}),a=function(){var t=(g(e,w.default.View),e);function e(){return _(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return t.prototype.template=f,t}.call(void 0),d=y.default.renderable(function(t){var e;return y.default.div(".row.listview-list-entry",function(){return y.default.text(t.user.fullname+" is a worker.")}),y.default.div(".row.listview-list-entry.work-session"),e={action:"in",btnClass:".clock-btn.btn.btn-info.fa.fa-clock-o"},"in",null===t.status&&y.default.div(".row.listview-list-entry",function(){return y.default.text(t.user.fullname+" has never clocked in.")}),"on"===t.status&&(e.action="out",e.btnClass=".clock-btn.btn.btn-warning.fa.fa-clock-o"),y.default.div(".row",function(){return y.default.button(e.btnClass,function(){return y.default.text("Clock "+e.action)})})}),c=y.default.renderable(function(r){return y.default.div(function(){var t,e,n,o;return e=r.session,"off"===(o=r.worker.status)&&e.end?(t=(0,v.default)(e.end),y.default.text("Your last session ended "+t.fromNow())):"on"===o?(n=(0,v.default)(e.start),y.default.text("You have been working since "+n.fromNow())):void 0})}),l=function(){var t=(g(e,w.default.View),o(e,[{key:"onSomething",value:function(){var t;return t=this.model.get("id"),new b.default({worker_id:t})}}]),e);function e(){return _(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return t.prototype.template=c,t}.call(void 0),s=function(){var t=(g(e,w.default.View),o(e,[{key:"ui",value:function(){return{clockBtn:".clock-btn",workSessionRegion:".work-session"}}},{key:"events",value:function(){return{"click @ui.clockBtn":"punchClock"}}},{key:"onRender",value:function(){var e,n=this;return this.model,(e=new b.default).fetch().done(function(){var t;return t=new l({model:e}),n.showChildView("workSessionRegion",t)})}},{key:"punchClock",value:function(){var t;return this.model,"off"===(t=this.model.get("status"))||null===t?this.punchIn():"on"===t?this.punchOut():i.request("warning","Bad worker status "+t)}},{key:"punchIn",value:function(){var t,e,n=this;return this.model.get("id"),t=new b.default,(e=t.save(null,{type:"POST",url:t.urlRoot})).done(function(){return n.updateLocalStatus("on")}),e.fail(function(){return i.request("warning",e.responseJSON.code)})}},{key:"punchOut",value:function(){var e,t,n=this;return t=this.model.get("id"),(e=new b.default({worker_id:t})).fetch().done(function(){var t;return(t=e.save()).done(function(){return n.updateLocalStatus("off")}),t.fail(function(){return i.request("warning",t.responseJSON.code)})})}},{key:"updateLocalStatus",value:function(t){return this.model.set("status",t),this.render()}}]),e);function e(){return _(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return t.prototype.template=d,t.prototype.regions={workSessionRegion:"@ui.workSessionRegion"},t}.call(void 0),p=y.default.renderable(function(t){return y.default.div(".row.status")}),u=function(){var t=(g(e,w.default.View),o(e,[{key:"ui",value:function(){return{status:".status"}}},{key:"onRender",value:function(){var t,e=this;return(t=this.model.fetch()).done(function(){var t;return t=new s({model:e.model}),e.showChildView("status",t)}),t.fail(function(){var t;return t=new a({model:e.model}),e.showChildView("status",t)})}}]),e);function e(){return _(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return t.prototype.template=p,t.prototype.regions={status:"@ui.status"},t.prototype.templateContext={appName:"hourly"},t}.call(void 0),t.exports=u},469:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,u,i,a=n(1),l=(o=a)&&o.__esModule?o:{default:o};u=l.default.Radio.channel("global"),l.default.Radio.channel("hourly"),r=u.request("main:app:AuthModel"),u.request("main:app:AuthCollection"),i=function(){var t=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e);function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return t.prototype.urlRoot="/api/dev/hourly/time-clock",t}.call(void 0),e.default=i}}]);
//# sourceMappingURL=hourly-view-index-f2931aba773bd5458f37.js.map