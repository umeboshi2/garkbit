(self.webpackJsonp=self.webpackJsonp||[]).push([[64],{204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,a,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=d(n(1)),l=d(n(2)),c=d(n(3)),s=(d(n(151)),d(n(18)));function d(e){return e&&e.__esModule?e:{default:e}}r=u.default.Radio.channel("global"),u.default.Radio.channel("messages"),u.default.Radio.channel("places"),a=c.default.renderable(function(e,t){return c.default.dl(".row",function(){return c.default.dt(".col",(0,s.default)(t)),c.default.dd(".col",e[t])})}),o=function(){var e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.View),i(t,[{key:"addLocationBtnClicked",value:function(){var e=this;return console.log("addLocationBtnClicked"),n.e(95).then(function(){var t;return t=new(0,n(292).default)({model:e.model}),r.request("main:app:show-modal",t)}.bind(null,n)).catch(n.oe)}},{key:"cancelBtnClicked",value:function(){return this.trigger("add:location:cancelled")}}]),t}();return e.prototype.template=c.default.renderable(function(e){var t;return t=e.coords,c.default.div(".card",function(){return c.default.div(".card-body",function(){return["latitude","longitude","accuracy"].forEach(function(e){return a(t,e)})}),c.default.div(".card-footer",function(){return c.default.button(".cancel-btn.btn.btn-warning","Cancel"),c.default.button(".add-location-btn.btn.btn-primary","Add location")})})}),e.prototype.ui={status:".status",addLocationBtn:".add-location-btn",cancelBtn:".cancel-btn"},e.prototype.events={"click @ui.addLocationBtn":"addLocationBtnClicked","click @ui.cancelBtn":"cancelBtnClicked"},e}.call(void 0),t.default=o},584:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(1)),u=s(n(2)),l=s(n(3)),c=(s(n(28)),s(n(101)));s(n(90));function s(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}i.default.Radio.channel("global"),i.default.Radio.channel("places"),r=function(){var e=function(e){function t(){return d(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,u.default.View),a(t,[{key:"className",value:function(){return"list-group-item location-item row"}}]),t}();return e.prototype.template=l.default.renderable(function(e){return l.default.span(".mr-auto",function(){return l.default.a({href:"#places/view/"+e.id},e.name)})}),e.prototype.tagName="li",e}.call(void 0),o=function(){var e=function(e){function t(){return d(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,c.default),a(t,[{key:"ui",value:function(){return{itemList:".places-container",paginateBar:".paginate-bar"}}}]),t}();return e.prototype.ItemView=r,e.prototype.template=l.default.renderable(function(){return l.default.div(".listview-header",function(){return l.default.text("Your Places")}),l.default.hr(),l.default.div(".paginate-bar"),l.default.div(".places-container")}),e}.call(void 0),t.default=o},587:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=c(n(1)),a=c(n(2)),i=c(n(3)),u=(c(n(8)),c(n(110)));n(207),n(588),n(592),n(611),n(612),n(613);c(n(151)),c(n(204)),c(n(205));var l=c(n(128));n(206);function c(e){return e&&e.__esModule?e:{default:e}}var s,d,f,p;d=o.default.Radio.channel("global"),p=o.default.Radio.channel("messages"),s=o.default.Radio.channel("places"),f=function(){var e=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.locationSuccess=e.locationSuccess.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default.View),r(t,[{key:"initialize",value:function(e){return this.currentMarkers=this.getOption("currentMarkers")||[],this.currentRadius=this.getOption("currentRadius")||0}},{key:"onDomRefresh",value:function(){var e,t=this;return console.log("onDomRefresh"),this.getLocation(),e={animate:"fast",classes:{"ui-slider":"highlight"},disabled:!1,max:1500,min:0,step:10,change:function(e,n){return console.log("ui.value",n.value),t.setRadius(n.value),t.ui.radiusLabel.text("("+n.value+" meters)")}},this.ui.radiusSlider.slider(e),console.log("@ui.radiusSlider",this.ui.radiusSlider)}},{key:"onRender",value:function(){return console.log("onRender")}},{key:"getLocation",value:function(){var e;return e={success:this.locationSuccess,error:this.locationError},d.request("main:app:getCurrentPosition",e)}},{key:"showMap",value:function(){var e,t,n,r;return n=new l.default({mapWidth:"30rem"}),this.showChildView("mapContainer",n),console.log("view",n),r=13,t=[(e=this.currentPosition).latitude,e.longitude],e.accuracy>150&&(r=13),n.Map.setView(t,r),this.addMarkers({map:n.Map,radius:this.currentRadius})}},{key:"locationSuccess",value:function(e){return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,t),console.log("locationSuccess",e),e=e.coords,this.currentPosition=e,console.log("finish rendering map"),this.showMap()}},{key:"locationError",value:function(){return p.request("warning","Unable to get current location.")}},{key:"setMarkersOrig",value:function(e){var t,n,r;for(r=[],t=0,n=e.length;t<n;t++)e[t],r.push(null);return r}},{key:"addMarkers",value:function(e){var t,n=this;return t=s.request("db:userlocation:collection"),console.log("addMarkers",this.currentPosition),t.fetch({data:{all:!0,peer:{latitude:this.currentPosition.latitude,longitude:this.currentPosition.longitude,radius:this.currentRadius}}}).done(function(){var r;return r=n.getRegion("mapContainer").currentView.Map,console.log("map is",r),e={models:t.models,map:r},n.setMarkers(e)})}},{key:"setMarkers",value:function(e){var t,n,r,o,a,i=this;for(console.log("setMarkers options",e),a=[],t=0,n=(o=e.models).length;t<n;t++)r=o[t],a.push(function(t){var n,r,o;return n=[(r=t.get("location")).latitude,r.longitude],(o=u.default.marker(n,{icon:u.default.icon.glyph({prefix:"fa",glyph:"circle"}),title:t.get("name")})).on("click",function(){return console.log("marker clicked",o,o.title)}),o.addTo(e.map),i.currentMarkers.push(o)}(r));return a}},{key:"setRadius",value:function(e){var t,n=this;return this.currentRadius=e,this.currentMarkers.forEach(function(e){return n.getRegion("mapContainer").currentView.Map.removeLayer(e)}),t=s.request("db:userlocation:collection"),console.log("addMarkers",this.currentPosition),t.fetch({data:{all:!0,peer:{latitude:this.currentPosition.latitude,longitude:this.currentPosition.longitude,radius:this.currentRadius}}}).done(function(){var e;return e=n.getRegion("mapContainer").currentView.Map,n.setMarkers({models:t.models,map:e})})}}]),t}();return e.prototype.template=i.default.renderable(function(e){return i.default.div(".listview-header","All Locations"),i.default.div(".mb-2.radius-slider"),i.default.div(".radius-label"),i.default.div(".col.map-container")}),e.prototype.ui={mapContainer:".map-container",radiusSlider:".radius-slider",radiusLabel:".radius-label"},e.prototype.regions={mapContainer:"@ui.mapContainer"},e}.call(void 0),t.default=f}}]);
//# sourceMappingURL=places-view-list-places-a1f709bd6163905144a1.js.map