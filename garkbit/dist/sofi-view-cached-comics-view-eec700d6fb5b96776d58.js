(self.webpackJsonp=self.webpackJsonp||[]).push([[65],{107:function(e,t,r){"use strict";var o,n,i,s,a,u,l,c,h=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}();function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}o=r(1),u=r(2),c=r(3);var y=r(34);y.make_field_input,y.make_field_select;var v=r(20);l=v.modal_close_button,a=o.Radio.channel("global"),o.Radio.channel("messages"),o.Radio.channel("sofi"),n=a.request("main:app:BaseModalView"),s=function(){var e=function(e){function t(){return f(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,n),t}();return e.prototype.template=c.renderable(function(e){return e.mainsection,c.div(".modal-dialog",function(){return c.div(".modal-content",function(){return c.div(".modal-body",function(){return c.img({src:e.image_src})}),c.div(".modal-footer",function(){return c.ul(".list-inline",function(){return"btn.btn-default.btn-sm",c.li("#close-modal",function(){return l("Close","check")})})})})})}),e}.call(void 0),i=function(e){function t(){return f(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,u.Behavior),h(t,[{key:"onShowImageModal",value:function(){var e;return e=new s({model:this.view.model}),a.request("show-modal",e)}}]),t}(),e.exports=i},170:function(e,t,r){"use strict";var o,n,i,s,a=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}();r(1),n=r(2),i=r(82),s=r(87),o=function(){var e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Behavior),a(t,[{key:"ui",value:function(){return{list:this.getOption("listContainer")}}},{key:"setMasonry",value:function(){var e,t;return e=this.getOption("listContainer"),t=this.getOption("masonryOptions"),this.view.masonry=new i(e,t)}},{key:"setMasonryLayout",value:function(){var e,t,r=this;return t=this.getOption("masonryOptions"),e=this.$(t.itemSelector),s(e,function(){return r.view.masonry.reloadItems(),r.view.masonry.layout()})}},{key:"onBeforeDestroy",value:function(){return this.view.masonry.destroy()}},{key:"onDomRefresh",value:function(){var e;if(this.setMasonry(),this.setMasonryLayout(),null!=(e=this.view)?e.afterDomRefresh:void 0)return this.view.afterDomRefresh()}}]),t}();return e.prototype.options={listContainer:".list-container",channel:"global",masonryOptions:{gutter:1,isInitLayout:!1,itemSelector:".item",columnWidth:10,horizontalOrder:!0}},e.prototype.regions={list:"@ui.list"},e}.call(void 0),e.exports=o},455:function(e,t,r){"use strict";var n=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u,l,o,c,h,f,p,d,y,v,m,g,b,w,_,k,O,j,E,C,I,x,L,T,P,B,R=[].indexOf;j=r(0),l=r(1),w=r(2),r(82),r(87),P=r(3),d=r(44),O=r(89),r(5);var q=r(34);q.make_field_input,q.make_field_select,r(34).form_group_input_div,m=r(170),v=r(107),y=r(94),b=l.Radio.channel("global"),_=l.Radio.channel("messages"),u=l.Radio.channel("sofi"),B=[{id:"server",label:"Server Images",url:"#sofi",icon:".fa.fa-server"},{id:"browser",label:"Browser Images",url:"#sofi",icon:".fa.fa-internet-explorer"}],f=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,O),n(t,[{key:"onChildviewToolbarEntryClicked",value:function(e){return this.trigger("toolbar:"+e.model.id+":click",e)}},{key:"onDomRefresh",value:function(){return console.log("onDomRefresh",this.regions),this.getChildView("entries").$el.removeClass("btn-group-justified")}}]),t}();return e.prototype.options={entryTemplate:P.renderable(function(e){return P.i(e.icon),P.text(" "),P.text(e.label)})},e}.call(void 0),c=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,w.View),t}();return e.prototype.ui={image:"img"},e.prototype.triggers={"click @ui.image":"show:image:modal"},e.prototype.behaviors=[v],e.prototype.template=P.renderable(function(e){var t;return t=u.request("fix-image-url",e.image_src),P.div(".item",function(){return P.img({src:t})})}),e}.call(void 0),o=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,w.CollectionView),t}();return e.prototype.childView=c,e.prototype.emptyView=d,e}.call(void 0),E={browser:[{id:"destroy",label:"Delete All",icon:".fa.fa-erase"}],server:[{id:"backup",label:"Backup",icon:".fa.fa-download"},{id:"restore",label:"Restore",icon:".fa.fa-upload"}]},g=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,O),n(t,[{key:"onChildviewToolbarEntryClicked",value:function(){}}]),t}();return e.prototype.childViewTriggers={"toolbar:entry:clicked":"toolbar:entry:clicked"},e}.call(void 0),x={gutter:1,isInitLayout:!(I=".list-container"),itemSelector:".item",columnWidth:10,horizontalOrder:!1},h=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,w.View),n(t,[{key:"ui",value:function(){return{toolbar:".toolbar",list:I,header:".listview-header"}}},{key:"onRender",value:function(){var e,t,r;return t=new o({collection:this.collection}),this.showChildView("list",t),e=this.getOption("cacheType"),r=new g({collection:new l.Collection(E[e]),cacheType:e}),this.showChildView("toolbar",r),this.triggerMethod("set:header",this.collection.length+" images stored in the "+this.getOption("cacheType"))}},{key:"onChildviewToolbarEntryClicked",value:function(e){var t,r;return t=this.getOption("cacheType"),r=["browser","server"],0<=R.call(r,t)?this[t+"ButtonClicked"](e):this.toolbarButtonClicked(e)}},{key:"toolbarButtonClicked",value:function(e){return console.warn("we don't have a cacheType on this toolbar")}},{key:"browserButtonClicked",value:function(e){if("destroy"===e.model.id)return this.destroyLocalImages()}},{key:"serverButtonClicked",value:function(e){var t;return"backup"===(t=e.model.id)?this.backupServerImages():"restore"===t?this.restoreServerImages():void 0}},{key:"backupServerImages",value:function(){var e,s=this;return(e=this.collection.fetch()).done(function(){var e,t,r,o,n,i;for(r=[],e=0,o=(i=s.collection.toJSON()).length;e<o;e++)delete(t=i[e]).id,r.push(t);return n={type:"data:text/json;charset=utf-8",data:JSON.stringify({items:r}),el_id:"exported-urls-anchor",filename:"url-backup.json"},b.request("export-to-file",n)}),e.fail(function(){return _.request("danger","Failed to get image urls!")})}},{key:"restoreServerImages",value:function(){return this.trigger("restore:server:images")}},{key:"destroyLocalImages",value:function(){return u.request("clear-comic-image-urls"),this.collection.reset()}}]),t}();return e.prototype.regions={toolbar:"@ui.toolbar",list:"@ui.list"},e.prototype.behaviors={HasMasonryView:{behaviorClass:m,listContainer:I,masonryOptions:x},HasHeader:{behaviorClass:y}},e.prototype.template=P.renderable(function(e){return P.div(function(){return P.div(".listview-header"),P.div(".toolbar"),P.div(I)})}),e}.call(void 0),C=function(e,t){var r;return r=t.collection,console.log("insert_model",r,e),r.create(e)},T=function(e,t){var r,o;return(o=(r=t.collection).fetch({data:{where:{url:e.url}}})).fail(function(){return"There was a problem talking to the server",_.request("warning","There was a problem talking to the server")}),o.done(function(){if(!r.length)return C(e,t)})},L=function(e){var t,r;return t=u.request("db:clzpage:collection"),r={collection:t},e.forEach(function(e){return T(e,r)})},k=function(){var e=function(e){function o(){i(this,o);var e=s(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments));return e.jsonReaderOnLoad=e.jsonReaderOnLoad.bind(e),e}return a(o,w.View),n(o,[{key:"restore_changed",value:function(e){var t;return this.ui.restore_btn.hide(),this.ui.upload_btn.show(),this.ui.restore_lbl.hide(),this.ui.restore_lbl.removeClass("btn btn-default"),t=e.target.files[0].name,this.ui.upload_btn.text("Upload "+t)}},{key:"reset_restore_button",value:function(){return this.ui.restore_btn.hide(),this.ui.restore_lbl.show(),this.ui.restore_lbl.addClass("btn btn-default"),this.ui.restore_lbl.val(""),this.ui.upload_btn.hide()}},{key:"upload_items",value:function(){var e,t;return e=this.ui.restore_btn[0].files[0],(t=new FileReader).onload=this.jsonReaderOnLoad,t.readAsText(e)}},{key:"jsonReaderOnLoad",value:function(e){var t,r;return function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}(this,o),t=e.target.result,(null!=(r=JSON.parse(t))?r.items:void 0)?L(r.items):this.reset_restore_button(),this.reset_restore_button()}}]),o}();return e.prototype.ui={restore_btn:".restore-button",restore_lbl:".restore-label",upload_btn:".upload-button"},e.prototype.events={"click @ui.upload_btn":"upload_items","change @ui.restore_btn":"restore_changed"},e.prototype.template=P.renderable(function(e){return P.div(".listview-header",function(){return P.div("Restore the image urls to the server.")}),P.label(".restore-label.btn.btn-default.btn-file",function(){return P.span("restore "),P.input(".restore-button.input",{type:"file",style:"display:none"})}),P.button(".upload-button.btn.btn-default",{style:"display:none"})}),e}.call(void 0),p=function(){var e=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,w.View),n(t,[{key:"onRender",value:function(){var e;return e=new f({collection:new l.Collection(B)}),this.showChildView("toolbar",e),this.triggerMethod("set:header","Cached Comic Cover Images")}},{key:"restore_server_images",value:function(){var e;return e=new k,this.showChildView("content",e)}},{key:"view_local_storage",value:function(){var r,o,e;return r=new l.Collection,delete(o=j.clone(u.request("get-comic-image-urls"))).id,Object.keys(o).forEach(function(e){var t;return t={url:e,image_src:o[e]},r.add(t)}),e=new h({collection:r,cacheType:"browser"}),this.showChildView("content",e)}},{key:"view_server_storage",value:function(){var t,e,r=this;return(e=(t=u.request("db:clzpage:collection")).fetch()).done(function(){var e;return e=new h({collection:t,cacheType:"server"}),r.showChildView("content",e)}),e.fail(function(){return _.request("danger","Failed to get cached comics")})}}]),t}();return e.prototype.ui={content:".content-container",toolbar:".images-toolbar",header:".listview-header"},e.prototype.regions={content:"@ui.content",toolbar:"@ui.toolbar"},e.prototype.behaviors=[y],e.prototype.template=P.renderable(function(e){return P.div(function(){return P.div(".listview-header"),P.div(".images-toolbar"),P.div(".content-container")})}),e.prototype.childViewEvents={"toolbar:browser:click":"view_local_storage","toolbar:server:click":"view_server_storage","restore:server:images":"restore_server_images"},e}.call(void 0),e.exports=p},87:function(r,o,n){var i,s;
/*!
 * imagesLoaded v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
/*!
 * imagesLoaded v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(t,e){"use strict";i=[n(96)],void 0===(s=function(e){return function(t,e){var n=t.jQuery,i=t.console;function s(e,t){for(var r in t)e[r]=t[r];return e}var a=Array.prototype.slice;function u(e,t,r){if(!(this instanceof u))return new u(e,t,r);var o=e;"string"==typeof e&&(o=document.querySelectorAll(e)),o?(this.elements=function(e){if(Array.isArray(e))return e;return"object"!=typeof e||"number"!=typeof e.length?[e]:a.call(e)}(o),this.options=s({},this.options),"function"==typeof t?r=t:s(this.options,t),r&&this.on("always",r),this.getImages(),n&&(this.jqDeferred=new n.Deferred),setTimeout(this.check.bind(this))):i.error("Bad element for imagesLoaded "+(o||e))}(u.prototype=Object.create(e.prototype)).options={},u.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},u.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&l[t]){for(var r=e.querySelectorAll("img"),o=0;o<r.length;o++){var n=r[o];this.addImage(n)}if("string"==typeof this.options.background){var i=e.querySelectorAll(this.options.background);for(o=0;o<i.length;o++){var s=i[o];this.addElementBackgroundImages(s)}}}};var l={1:!0,9:!0,11:!0};function r(e){this.img=e}function o(e,t){this.url=e,this.element=t,this.img=new Image}return u.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var r=/url\((['"])?(.*?)\1\)/gi,o=r.exec(t.backgroundImage);null!==o;){var n=o&&o[2];n&&this.addBackground(n,e),o=r.exec(t.backgroundImage)}},u.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},u.prototype.addBackground=function(e,t){var r=new o(e,t);this.images.push(r)},u.prototype.check=function(){var o=this;function t(e,t,r){setTimeout(function(){o.progress(e,t,r)})}this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?this.images.forEach(function(e){e.once("progress",t),e.check()}):this.complete()},u.prototype.progress=function(e,t,r){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&i&&i.log("progress: "+r,e,t)},u.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},(r.prototype=Object.create(e.prototype)).check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.src)},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},(o.prototype=Object.create(r.prototype)).check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},o.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},o.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},u.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((n=e).fn.imagesLoaded=function(e,t){return new u(this,e,t).jqDeferred.promise(n(this))})},u.makeJQueryPlugin(),u}(t,e)}.apply(o,i))||(r.exports=s)}("undefined"!=typeof window?window:this)},94:function(e,t,r){"use strict";var o,n,i=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}();r(1),n=r(2),r(3),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Behavior),i(t,[{key:"onSetHeader",value:function(e){return this.ui.header.text(e)}}]),t}(),e.exports=o}}]);
//# sourceMappingURL=sofi-view-cached-comics-view-eec700d6fb5b96776d58.js.map