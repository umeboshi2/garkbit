(self.webpackJsonp=self.webpackJsonp||[]).push([[63],{128:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=(u(n(1)),n(2)),a=(u(n(3)),u(n(110)));function u(t){return t&&t.__esModule?t:{default:t}}n(129),o=function(){var t=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.View),r(e,[{key:"attributes",value:function(){return{style:"width: "+(this.getOption("mapWidth")||"10rem")+"; height: "+(this.getOption("mapHeight")||"10rem")+";"}}},{key:"onDomRefresh",value:function(){return this.Map=a.default.map("map-view"),13,a.default.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(this.Map)}}]),e}();return t.prototype.id="map-view",t.prototype.template=!1,t}.call(void 0),e.default=o},151:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e;return e={},i.default.forEach(function(n){var o;return o=t[n],e[n]=o}),e};var o,r=n(203),i=(o=r)&&o.__esModule?o:{default:o}},203:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=["latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed"]},204:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,i,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=f(n(1)),s=f(n(2)),l=f(n(3)),c=(f(n(151)),f(n(18)));function f(t){return t&&t.__esModule?t:{default:t}}o=u.default.Radio.channel("global"),u.default.Radio.channel("messages"),u.default.Radio.channel("places"),i=l.default.renderable(function(t,e){return l.default.dl(".row",function(){return l.default.dt(".col",(0,c.default)(e)),l.default.dd(".col",t[e])})}),r=function(){var t=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default.View),a(e,[{key:"addLocationBtnClicked",value:function(){var t=this;return console.log("addLocationBtnClicked"),n.e(95).then(function(){var e;return e=new(0,n(291).default)({model:t.model}),o.request("main:app:show-modal",e)}.bind(null,n)).catch(n.oe)}},{key:"cancelBtnClicked",value:function(){return this.trigger("add:location:cancelled")}}]),e}();return t.prototype.template=l.default.renderable(function(t){var e;return e=t.coords,l.default.div(".card",function(){return l.default.div(".card-body",function(){return["latitude","longitude","accuracy"].forEach(function(t){return i(e,t)})}),l.default.div(".card-footer",function(){return l.default.button(".cancel-btn.btn.btn-warning","Cancel"),l.default.button(".add-location-btn.btn.btn-primary","Add location")})})}),t.prototype.ui={status:".status",addLocationBtn:".add-location-btn",cancelBtn:".cancel-btn"},t.prototype.events={"click @ui.addLocationBtn":"addLocationBtnClicked","click @ui.cancelBtn":"cancelBtnClicked"},t}.call(void 0),e.default=r},205:function(t,e,n){"use strict";n.r(e);var o=n(122),r=n.n(o);function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var l=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.interval,r=void 0===o?1e3:o,i=n.stopwatch,u=void 0!==i&&i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=s(this,a(e).call(this)))._interval=r,t._stopwatch=u,t._endTime=0,t._pauseTime=0,t._duration=null,t._timeoutID=null,t._status="stopped",t}var n,o,l;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,r.a),n=e,(o=[{key:"start",value:function(t,e){if("stopped"===this._status){if(null==t)throw new TypeError("must provide duration parameter");this._duration=t,this._endTime=Date.now()+t,this._changeStatus("running"),this.emit("tick",this._stopwatch?0:this._duration),this._timeoutID=setInterval(function(){"paused"!==this._status&&(Date.now()>=this._endTime?(this.stop(),this.emit("tick",this._stopwatch?this._duration:0),this.emit("done")):this.emit("tick",this.time))}.bind(this),e||this._interval)}}},{key:"stop",value:function(){clearInterval(this._timeoutID),this._changeStatus("stopped")}},{key:"pause",value:function(){"running"===this._status&&(this._pauseTime=Date.now(),this._changeStatus("paused"))}},{key:"resume",value:function(){"paused"===this._status&&(this._endTime+=Date.now()-this._pauseTime,this._pauseTime=0,this._changeStatus("running"))}},{key:"_changeStatus",value:function(t){this._status=t,this.emit("statusChanged",this._status)}},{key:"time",get:function(){if("stopped"===this._status)return 0;var t="paused"===this._status?this._pauseTime:Date.now(),e=this._endTime-t;return this._stopwatch?this._duration-e:e}},{key:"duration",get:function(){return this._duration}},{key:"status",get:function(){return this._status}}])&&i(n.prototype,o),l&&i(n,l),e}();e.default=l},206:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProgressView=e.ProgressModel=void 0;var o,r,i,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=c(n(1)),s=n(2),l=c(n(3));function c(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.ProgressModel=r=function(){var t=function(t){function e(){return f(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return d(e,u.default.Model),e}();return t.prototype.defaults={valuemin:0,valuemax:100,valuenow:0},t}.call(void 0),o=function(){var t=function(t){function e(){return f(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return d(e,s.View),a(e,[{key:"className",value:function(){return this.getOption("className")||"progress-bar progress-bar-striped"}},{key:"attributes",value:function(){return{role:"progressbar",style:"width: "+this.getWidth()+"%;"}}},{key:"templateContext",value:function(){var t;return t=this.model.get("valuenow")+" of "+this.model.get("valuemax"),{textStyle:this.getOption("textStyle")||"color:black;",textLabel:this.getOption("textLabel")||t}}},{key:"getWidth",value:function(){var t,e;return t=this.model.get("valuenow"),e=this.model.get("valuemax"),Math.floor(t/e*100+.5)}},{key:"onRender",value:function(){return this.$el.css({width:this.getWidth()+"%"})}}]),e}();return t.prototype.template=l.default.renderable(function(t){return l.default.span({style:t.textStyle},l.default.text(t.textLabel))}),t.prototype.modelEvents={change:"render"},t}.call(void 0),e.ProgressView=i=function(){var t=function(t){function e(){return f(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return d(e,s.View),a(e,[{key:"createModel",value:function(t){return new r(t)}},{key:"templateContext",value:function(){return{wrapperClasses:this.getOption("wrapperClasses")||".pb-wrapper"}}},{key:"onRender",value:function(){var t,e;return(e=this.getOption("childViewOptions")||{}).model=this.model,t=new o(e),this.showChildView("pbWrapper",t)}}]),e}();return t.prototype.className="progress",t.prototype.template=l.default.renderable(function(t){var e;return e=".pb-wrapper",t.wrapperClasses&&(e=".pb-wrapper."+t.wrapperClasses),l.default.div(e)}),t.prototype.ui={pbWrapper:".pb-wrapper"},t.prototype.regions={pbWrapper:"@ui.pbWrapper"},t}.call(void 0),e.ProgressModel=r,e.ProgressView=i},578:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=h(n(1)),i=h(n(2)),a=h(n(3)),u=h(n(8)),s=h(n(110)),l=h(n(151)),c=h(n(204)),f=h(n(205)),p=h(n(128)),d=n(206);function h(t){return t&&t.__esModule?t:{default:t}}var y,b,w,v,m=function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")};b=r.default.Radio.channel("global"),v=r.default.Radio.channel("messages"),y=r.default.Radio.channel("places"),w=function(){var t=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.locationSuccess=t.locationSuccess.bind(t),t.locationError=t.locationError.bind(t),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default.View),o(e,[{key:"onRender",value:function(){if(this.collection.length<1)return v.request("warning","No locations found")}},{key:"locationBtnClicked",value:function(){var t;return t={success:this.locationSuccess,error:this.locationError},b.request("main:app:getCurrentPosition",t),this.ui.locationBtn.removeClass("btn-primary"),this.ui.locationBtn.addClass("btn-warning")}},{key:"locationSuccess",value:function(t){var n,o,r,i,a,u;return m(this,e),this.ui.locationBtn.hide(),this.ui.locationBtn.removeClass("btn-warning"),this.ui.locationBtn.addClass("btn-primary"),o=(0,l.default)(t.coords),i=new(y.request("db:userlocation:modelClass"))({coords:o,timestamp:t.timestamp}),a=new p.default({model:i,mapWidth:"12rem",mapHeight:"10rem"}),this.showChildView("mainMapContainer",a),u=16,r=[o.latitude,o.longitude],(n=o.accuracy)>100&&(u=13),a.Map.setView(r,u),s.default.circle(r,n).addTo(a.Map),a=new c.default({model:i}),this.showChildView("locationStatus",a)}},{key:"setLocation",value:function(t){var e,n,o;return console.log("setLocation",t),17,n=[(o=t.model.get("location")).latitude,o.longitude],(e=o.accuracy)>10&&(e=10),s.default.circle(n,e).addTo(this.Map)}},{key:"locationError",value:function(t){return m(this,e),console.log("locationError",t),v.request("warning",t.message),this.ui.locationBtn.removeClass("btn-warning"),this.ui.locationBtn.addClass("btn-primary"),this.showWaitProgress()}},{key:"showWaitProgress",value:function(){var t,e,n,o,r,i=this;return this.ui.locationBtn.hide(),e=new d.ProgressModel,o=new d.ProgressView({className:"progress row",model:e,wrapperClasses:"col",childViewOptions:{className:"progress-bar progress-bar-striped bg-warning"}}),this.showChildView("waitProgress",o),r=function(){return i.getRegion("waitProgress").empty(),i.ui.locationBtn.show()},t=(0,u.default)("11s"),100,e.set("valuemax",t),e.set("valuenow",t),(n=new f.default).on("tick",function(t){return e.set("valuenow",t)}),n.on("done",function(){return r()}),n.start(t,{interval:(0,u.default)(".1s")})}},{key:"onAddLocationCancelled",value:function(){return this.getRegion("locationStatus").empty(),this.ui.locationBtn.show(),this.ui.mainMapContainer.show()}}]),e}();return t.prototype.template=a.default.renderable(function(t){return a.default.div(".row.main-map-container"),a.default.div(".row",function(){return a.default.span(function(){return a.default.button(".get-location-btn.btn.btn-primary",function(){return a.default.text("Get Location")})})}),a.default.div(".row.location-status"),a.default.div(".row",function(){return a.default.div(".col.wait-progress")})}),t.prototype.ui={locationStatus:".location-status",locationBtn:".get-location-btn",mainMapContainer:".main-map-container",waitProgress:".wait-progress"},t.prototype.regions={locationStatus:"@ui.locationStatus",mainMapContainer:"@ui.mainMapContainer",waitProgress:"@ui.waitProgress"},t.prototype.events={"click @ui.locationBtn":"locationBtnClicked"},t.prototype.childViewEvents={"add:location:cancelled":"onAddLocationCancelled"},t}.call(void 0),e.default=w}}]);
//# sourceMappingURL=places-view-index-1000e8843e65ee85b29a.js.map