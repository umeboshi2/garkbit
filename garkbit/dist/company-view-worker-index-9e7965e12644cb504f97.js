(self.webpackJsonp=self.webpackJsonp||[]).push([[31],{137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;return e.fetchInfo,e.successCallback,e.failureCallback,t=e.fetchData||{},console.log("fetchData",t),function(e,n,o){var a,l,c;return console.log("fetchInfo",e),l=new r,a=s.default.extend(t,{start:e.startStr,end:e.endStr,limit:9999}),console.log("DATA",a),c=l.fetch({data:a}),console.log("response",c),c.done(function(){var e,t;return t=l.toJSON(),console.log("returned these events",t),console.log("events",l),e=[],l.forEach(function(t){var n,o,r;return"UTC",r=d.DateTime.fromISO(t.get("start"),{zone:"UTC"}),n=d.DateTime.fromISO(t.get("end"),{zone:"UTC"}),o={start:r.toLocal().toString(),end:n.toLocal().toString(),id:t.id,url:"#company/session/view/"+t.id,backgroundColor:i(t.get("worker_id"))},e.push(o)}),console.log("calendarEvents",e),n(e)}),c.fail(function(){return o(c),u.request("xhr-error",c)})}};var o,r,a,u,i,l,c,s=h(n(0)),f=h(n(1)),d=n(118),p=h(n(138));function h(e){return e&&e.__esModule?e:{default:e}}a=f.default.Radio.channel("global"),u=f.default.Radio.channel("messages"),o=a.request("main:app:AuthCollection"),r=function(){var e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();return e.prototype.url="/api/dev/company/calendar",e}.call(void 0),l=["green","chocolate","blue","magenta"],c={},i=function(e){var t,n;return c[e]?c[e]:(t=(0,p.default)(l),(n=l.indexOf(t))>-1&&l.splice(n,1),c[e]=t,c[e])}},385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=m(n(1)),a=m(n(2)),u=m(n(3)),i=(m(n(28)),m(n(115)));n(386),n(387);var l,c,s,f,d,p,h,b,v,y=m(n(389)),w=(m(n(5)),m(n(394))),k=m(n(137));function m(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}r.default.Radio.channel("global"),r.default.Radio.channel("messages"),l=r.default.Radio.channel("company"),p=l.request("TimeClock"),h=u.default.renderable(function(e){return u.default.div(".row.listview-list-entry",function(){return u.default.text("You are not a worker.")})}),s=function(){var e=function(e){function t(){return g(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,a.default.View),t}();return e.prototype.template=h,e}.call(void 0),b=u.default.renderable(function(e){return u.default.div(function(){var t,n,o,r;return n=e.session,r=e.worker.status,n?"off"===r&&n.end?(t=i.default.utc(n.end),u.default.text("Your last session ended "+t.fromNow())):"on"===r?(o=i.default.utc(n.start),u.default.text("You have been working since "+o.fromNow())):void 0:u.default.text("You have never clocked in.")})}),f=function(){var e=function(e){function t(){return g(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,a.default.View),o(t,[{key:"onSomething",value:function(){var e;return e=this.model.get("id"),new p({worker_id:e})}}]),t}();return e.prototype.template=b,e}.call(void 0),v=u.default.renderable(function(e){var t;return t={action:"in",btnClass:".clock-btn.btn.btn-info.fa.fa-clock-o"},"in","on"===e.status&&(t.action="out",t.btnClass=".clock-btn.btn.btn-warning.fa.fa-clock-o"),u.default.div(".row",function(){return u.default.div(".col.work-session")}),u.default.div(".btn-group",function(){return u.default.div(".clock-btn-container"),u.default.button(".month-btn.btn.btn-success.fa.fa-calendar","Month"),u.default.button(".week-btn.btn.btn-success.fa.fa-calendar","Week"),u.default.button(".day-btn.btn.btn-success.fa.fa-calendar","Day")}),u.default.div(".row.calendar"),u.default.input(".datepick")}),d=function(){var e=function(e){function t(){return g(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,a.default.View),o(t,[{key:"ui",value:function(){return{monthBtn:".month-btn",weekBtn:".week-btn",dayBtn:".day-btn",workSessionRegion:".work-session",calendarRegion:".calendar",clockBtnRegion:".clock-btn-container",datePick:".datepick"}}},{key:"events",value:function(){return{"click @ui.monthBtn":"monthBtnClicked","click @ui.weekBtn":"weekBtnClicked","click @ui.dayBtn":"dayBtnClicked"}}},{key:"onRender",value:function(){var e,t,n=this;return this.model,(e=new p).fetch().done(function(){var t;return console.log("clock is",e),t=new f({model:e}),n.showChildView("workSessionRegion",t)}),t=new w.default({model:this.model}),this.showChildView("clockBtnRegion",t)}},{key:"onDomRefreshOrig",value:function(){return this.ui.datePick.daterangepicker({timePicker:!0,locale:{format:"M/DD hh:mm A"}})}},{key:"monthBtnClicked",value:function(){return this.showCalendar({className:"col-md-8 offset-md-2",calendarOptions:{defaultDate:new Date,header:{left:"prevYear, nextYear",center:"title",right:"prev, next"},events:(0,k.default)({fetchData:this.getOption("fetchData")||{}})}})}},{key:"weekBtnClicked",value:function(){return this.showCalendar({className:"col-md-8 offset-md-2",calendarOptions:{defaultDate:new Date,defaultView:"timeGridWeek",header:{left:"prevYear, nextYear",center:"title",right:"prev, next"},events:(0,k.default)({fetchData:this.getOption("fetchData")||{}})}})}},{key:"dayBtnClicked",value:function(){return this.showCalendar({className:"col-md-8 offset-md-2",calendarOptions:{defaultDate:new Date,defaultView:"timeGridDay",header:{left:"prevYear, nextYear",center:"title",right:"prev, next"},events:(0,k.default)({fetchData:this.getOption("fetchData")||{}})}})}},{key:"showCalendar",value:function(e){var t;return t=new y.default(e),this.showChildView("calendarRegion",t)}}]),t}();return e.prototype.template=v,e.prototype.regions={workSessionRegion:"@ui.workSessionRegion",calendarRegion:"@ui.calendarRegion",clockBtnRegion:"@ui.clockBtnRegion"},e.prototype.childViewEvents={"worker:status:change":"render"},e}.call(void 0),c=function(){var e=function(e){function t(){return g(this,t),_(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return O(t,a.default.View),o(t,[{key:"ui",value:function(){return{status:".status"}}},{key:"onRender",value:function(){var e,t=this;return(e=this.model.fetch()).done(function(){var e;return e=new d({model:t.model}),t.showChildView("status",e)}),e.fail(function(){var e;return e=new s({model:t.model}),t.showChildView("status",e)})}}]),t}();return e.prototype.template=u.default.renderable(function(e){return u.default.div(".row.status")}),e.prototype.regions={status:"@ui.status"},e}.call(void 0),t.default=c},394:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,a,u,i,l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=d(n(1)),s=d(n(2)),f=d(n(3));d(n(28)),d(n(115)),d(n(5));function d(e){return e&&e.__esModule?e:{default:e}}c.default.Radio.channel("global"),a=c.default.Radio.channel("messages"),o=c.default.Radio.channel("company"),u=o.request("TimeClock"),i={on:"out",off:"in"},r=function(){var e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default.View),l(t,[{key:"templateContext",value:function(){}},{key:"onRender",value:function(){return"on"===this.model.get("status")?(this.$el.removeClass("btn-info"),this.$el.addClass("btn-warning")):(this.$el.removeClass("btn-warning"),this.$el.addClass("btn-info"))}},{key:"punchClock",value:function(){var e;return this.model,"off"===(e=this.model.get("status"))||null===e?this.punchIn():"on"===e?this.punchOut():a.request("danger","Bad worker status "+e)}},{key:"punchIn",value:function(){var e,t,n=this;return this.model.get("id"),e=new u,(t=e.save(null,{type:"POST",url:e.urlRoot})).done(function(){return n.updateLocalStatus("on")}),t.fail(function(){return a.request("xhr-error",t)})}},{key:"punchOut",value:function(){var e,t,n=this;return t=this.model.get("id"),(e=new u({worker_id:t})).fetch().done(function(){var t;return(t=e.save()).done(function(){return n.updateLocalStatus("off")}),t.fail(function(){return a.request("xhr-error",t)})})}},{key:"updateLocalStatus",value:function(e){return this.model.set("status",e),this.render(),this.trigger("worker:status:change")}}]),t}();return e.prototype.tagName="button",e.prototype.className="btn btn-info fa fa-clock-o",e.prototype.template=f.default.renderable(function(e){return f.default.text("Clock "+i[e.status])}),e.prototype.events={click:"punchClock"},e}.call(void 0),t.default=r}}]);
//# sourceMappingURL=company-view-worker-index-9e7965e12644cb504f97.js.map