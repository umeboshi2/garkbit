(self.webpackJsonp=self.webpackJsonp||[]).push([[71],{1040:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=n(1),i=n(3),a=h(n(6)),u=h(n(40)),s=h(n(391)),l=h(n(1041)),c=h(n(1043)),p=h(n(1044)),d=h(n(569)),f=n(1049);function h(t){return t&&t.__esModule?t:{default:t}}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var w,m,v,g,_=function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")};m=r.Radio.channel("global"),g=r.Radio.channel("messages"),w=r.Radio.channel("places"),v=function(){var t=function(t){function e(){b(this,e);var t=y(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.locationSuccess=t.locationSuccess.bind(t),t.locationError=t.locationError.bind(t),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),o(e,[{key:"onRender",value:function(){if(this.collection.length<1)return g.request("warning","No locations found")}},{key:"locationBtnClicked",value:function(){var t;return t={success:this.locationSuccess,error:this.locationError},m.request("main:app:getCurrentPosition",t),this.ui.locationBtn.removeClass("btn-primary"),this.ui.locationBtn.addClass("btn-warning")}},{key:"locationSuccess",value:function(t){var n,o,r,i,a,u;return _(this,e),this.ui.locationBtn.hide(),this.ui.locationBtn.removeClass("btn-warning"),this.ui.locationBtn.addClass("btn-primary"),o=(0,l.default)(t.coords),i=new(w.request("db:userlocation:modelClass"))({coords:o,timestamp:t.timestamp}),a=new d.default({model:i,mapWidth:"12rem",mapHeight:"10rem"}),this.showChildView("mainMapContainer",a),u=16,r=[o.latitude,o.longitude],(n=o.accuracy)>100&&(u=13),a.Map.setView(r,u),s.default.circle(r,n).addTo(a.Map),a=new c.default({model:i}),this.showChildView("locationStatus",a)}},{key:"setLocation",value:function(t){var e,n,o;return console.log("setLocation",t),n=[(o=t.model.get("location")).latitude,o.longitude],(e=o.accuracy)>10&&(e=10),s.default.circle(n,e).addTo(this.Map)}},{key:"locationError",value:function(t){return _(this,e),console.log("locationError",t),g.request("warning",t.message),this.ui.locationBtn.removeClass("btn-warning"),this.ui.locationBtn.addClass("btn-primary"),this.showWaitProgress()}},{key:"showWaitProgress",value:function(){var t,e,n,o,r,i=this;return this.ui.locationBtn.hide(),e=new f.ProgressModel,o=new f.ProgressView({className:"progress row",model:e,wrapperClasses:"col",childViewOptions:{className:"progress-bar progress-bar-striped bg-warning"}}),this.showChildView("waitProgress",o),r=function(){return i.getRegion("waitProgress").empty(),i.ui.locationBtn.show()},t=(0,u.default)("11s"),e.set("valuemax",t),e.set("valuenow",t),(n=new p.default).on("tick",(function(t){return e.set("valuenow",t)})),n.on("done",(function(){return r()})),n.start(t,{interval:(0,u.default)(".1s")})}},{key:"onAddLocationCancelled",value:function(){return this.getRegion("locationStatus").empty(),this.ui.locationBtn.show(),this.ui.mainMapContainer.show()}}]),e}(i.View);return t.prototype.template=a.default.renderable((function(){return a.default.div(".row.main-map-container"),a.default.div(".row",(function(){return a.default.span((function(){return a.default.button(".get-location-btn.btn.btn-primary",(function(){return a.default.text("Get Location")}))}))})),a.default.div(".row.location-status"),a.default.div(".row",(function(){return a.default.div(".col.wait-progress")}))})),t.prototype.ui={locationStatus:".location-status",locationBtn:".get-location-btn",mainMapContainer:".main-map-container",waitProgress:".wait-progress"},t.prototype.regions={locationStatus:"@ui.locationStatus",mainMapContainer:"@ui.mainMapContainer",waitProgress:"@ui.waitProgress"},t.prototype.events={"click @ui.locationBtn":"locationBtnClicked"},t.prototype.childViewEvents={"add:location:cancelled":"onAddLocationCancelled"},t}.call(void 0),e.default=v},1041:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e;return e={},i.default.forEach((function(n){var o;return o=t[n],e[n]=o})),e};var o,r=n(1042),i=(o=r)&&o.__esModule?o:{default:o}},1042:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=["latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed"]},1043:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,i,a,u=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=n(1),l=n(3),c=n(6),p=(o=c)&&o.__esModule?o:{default:o},d=n(0);function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}r=s.Radio.channel("global"),a=p.default.renderable((function(t,e){return p.default.dl(".row",(function(){return p.default.dt(".col",(0,d.capitalize)(e)),p.default.dd(".col",t[e])}))})),i=function(){var t=function(t){function e(){return f(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),u(e,[{key:"addLocationBtnClicked",value:function(){var t=this;return console.log("addLocationBtnClicked"),n.e(112).then(function(){var e;return e=new(0,n(1194).default)({model:t.model}),r.request("main:app:show-modal",e)}.bind(null,n)).catch(n.oe)}},{key:"cancelBtnClicked",value:function(){return this.trigger("add:location:cancelled")}}]),e}(l.View);return t.prototype.template=p.default.renderable((function(t){var e;return e=t.coords,p.default.div(".card",(function(){return p.default.div(".card-body",(function(){return["latitude","longitude","accuracy"].forEach((function(t){return a(e,t)}))})),p.default.div(".card-footer",(function(){return p.default.button(".cancel-btn.btn.btn-warning","Cancel"),p.default.button(".add-location-btn.btn.btn-primary","Add location")}))}))})),t.prototype.ui={status:".status",addLocationBtn:".add-location-btn",cancelBtn:".cancel-btn"},t.prototype.events={"click @ui.addLocationBtn":"addLocationBtnClicked","click @ui.cancelBtn":"cancelBtnClicked"},t}.call(void 0),e.default=i},1044:function(t,e,n){var o=n(557);class r extends o.EventEmitter{constructor({interval:t=1e3,stopwatch:e=!1}={}){super(),this._duration=0,this._endTime=0,this._pauseTime=0,this._status="stopped",this.tick=()=>{"paused"!==this.status&&(Date.now()>=this._endTime?(this.stop(),this.emit("tick",this._stopwatch?this._duration:0),this.emit("done")):this.emit("tick",this.time))},this._interval=t,this._stopwatch=e}start(t,e){if("stopped"===this.status){if(null==t)throw new TypeError("Must provide duration parameter");this._duration=t,this._endTime=Date.now()+t,this._changeStatus("running"),this.emit("tick",this._stopwatch?0:this._duration),this._timeoutID=setInterval(this.tick,e||this._interval)}}stop(){this._timeoutID&&clearInterval(this._timeoutID),this._changeStatus("stopped")}pause(){"running"===this.status&&(this._pauseTime=Date.now(),this._changeStatus("paused"))}resume(){"paused"===this.status&&(this._endTime+=Date.now()-this._pauseTime,this._pauseTime=0,this._changeStatus("running"))}_changeStatus(t){this._status=t,this.emit("statusChanged",this.status)}get time(){if("stopped"===this.status)return 0;const t="paused"===this.status?this._pauseTime:Date.now(),e=this._endTime-t;return this._stopwatch?this._duration-e:e}get duration(){return this._duration}get status(){return this._status}}t.exports=r},1049:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProgressView=e.ProgressModel=void 0;var o,r,i,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=c(n(1)),s=n(3),l=c(n(6));function c(t){return t&&t.__esModule?t:{default:t}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.ProgressModel=r=function(){var t=function(t){function e(){return p(this,e),d(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,t),e}(u.default.Model);return t.prototype.defaults={valuemin:0,valuemax:100,valuenow:0},t}.call(void 0),o=function(){var t=function(t){function e(){return p(this,e),d(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,t),a(e,[{key:"className",value:function(){return this.getOption("className")||"progress-bar progress-bar-striped"}},{key:"attributes",value:function(){return{role:"progressbar",style:"width: "+this.getWidth()+"%;"}}},{key:"templateContext",value:function(){var t;return t=this.model.get("valuenow")+" of "+this.model.get("valuemax"),{textStyle:this.getOption("textStyle")||"color:black;",textLabel:this.getOption("textLabel")||t}}},{key:"getWidth",value:function(){var t,e;return t=this.model.get("valuenow"),e=this.model.get("valuemax"),Math.floor(t/e*100+.5)}},{key:"onRender",value:function(){return this.$el.css({width:this.getWidth()+"%"})}}]),e}(s.View);return t.prototype.template=l.default.renderable((function(t){return l.default.span({style:t.textStyle},l.default.text(t.textLabel))})),t.prototype.modelEvents={change:"render"},t}.call(void 0),e.ProgressView=i=function(){var t=function(t){function e(){return p(this,e),d(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,t),a(e,[{key:"createModel",value:function(t){return new r(t)}},{key:"templateContext",value:function(){return{wrapperClasses:this.getOption("wrapperClasses")||".pb-wrapper"}}},{key:"onRender",value:function(){var t,e;return(e=this.getOption("childViewOptions")||{}).model=this.model,t=new o(e),this.showChildView("pbWrapper",t)}}]),e}(s.View);return t.prototype.className="progress",t.prototype.template=l.default.renderable((function(t){var e;return e=".pb-wrapper",t.wrapperClasses&&(e=".pb-wrapper."+t.wrapperClasses),l.default.div(e)})),t.prototype.ui={pbWrapper:".pb-wrapper"},t.prototype.regions={pbWrapper:"@ui.pbWrapper"},t}.call(void 0),e.ProgressModel=r,e.ProgressView=i},569:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),a=n(3),u=n(391),s=(o=u)&&o.__esModule?o:{default:o};function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}n(420),r=function(){var t=function(t){function e(){return l(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"attributes",value:function(){return{style:"width: "+(this.getOption("mapWidth")||"10rem")+"; height: "+(this.getOption("mapHeight")||"10rem")+";"}}},{key:"onDomRefresh",value:function(){return this.Map=s.default.map("map-view"),s.default.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(this.Map)}}]),e}(a.View);return t.prototype.id="map-view",t.prototype.template=!1,t}.call(void 0),e.default=r}}]);
//# sourceMappingURL=places-view-index-4d4b05c10ed917ea8a5c.js.map