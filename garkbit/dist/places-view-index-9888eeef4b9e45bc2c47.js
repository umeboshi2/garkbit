(self.webpackJsonp=self.webpackJsonp||[]).push([[60],{192:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=m(n(1)),a=m(n(2)),i=m(n(3)),l=m(n(153));n(154);m(n(89));var u,c,s,d,f,p,h,y=m(n(97)),b=m(n(193));function m(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}d=r.default.Radio.channel("global"),h=r.default.Radio.channel("messages"),u=r.default.Radio.channel("places"),c=function(){var e=function(e){function t(){return w(this,t),v(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return g(t,a.default.View),o(t,[{key:"className",value:function(){return"list-group-item location-item row d-flex"}}]),t}();return e.prototype.template=i.default.renderable(function(e){return i.default.span(".mr-auto",e.name),i.default.span(".ml-auto",function(){return i.default.button(".delete-btn.btn.btn-sm.btn-danger","Delete")})}),e.prototype.tagName="li",e.prototype.ui={label:".mr-auto",deleteBtn:".delete-btn"},e.prototype.triggers={"click @ui.label":"location:selected","click @ui.deleteBtn":"location:delete"},e}.call(void 0),s=function(){var e=function(e){function t(){return w(this,t),v(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return g(t,y.default),o(t,[{key:"ui",value:function(){return{itemList:".places-container",paginateBar:".paginate-bar"}}}]),t}();return e.prototype.ItemView=c,e.prototype.template=i.default.renderable(function(){return i.default.div(".paginate-bar"),i.default.div(".places-container.list-group")}),e.prototype.childViewTriggers={"location:selected":"location:selected","location:delete":"location:delete"},e}.call(void 0),p=function(){var e=function(e){function t(){return w(this,t),v(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return g(t,a.default.View),o(t,[{key:"mapOpdtions",value:function(){return{minZoom:14}}},{key:"onDomRefresh",value:function(){this.Map=l.default.map("map-view",this.getOption("mapOptions")),l.default.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(this.Map),this.setLocation()}},{key:"setLocation",value:function(){var e,t,n;return 17,t=[(n=this.model.get("location")).latitude,n.longitude],this.Map.setView(t,17),(e=n.accuracy)>10&&(e=10),l.default.circle(t,e).addTo(this.Map)}},{key:"onModelChange",value:function(){var e;return console.log("model changed"),this.setLocation(),this.ui.title.text(this.model.get("name")),e="#places/view/"+this.model.get("id"),d.request("main:app:setLocationUrl",e)}}]),t}();return e.prototype.template=i.default.renderable(function(e){return i.default.div(".card",{style:"width: 18rem;"},function(){return i.default.div(".card-body",function(){return i.default.h5(".card-title",e.name),i.default.div("#map-view.card-text",{style:"height:15rem;"})})})}),e.prototype.ui={map:"#map-view",title:".card-title"},e.prototype.modelEvents={change:"onModelChange"},e}.call(void 0),f=function(){var e=function(e){function t(){return w(this,t),v(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return g(t,a.default.View),o(t,[{key:"onRender",value:function(){var e,t,n,o=this;return n=new p({model:this.model}),this.showChildView("mapContainer",n),e=u.request("db:userlocation:collection"),(t=e.fetch()).fail(function(){return h.request("xhr-error",t)}),t.done(function(){return n=new s({collection:e}),o.showChildView("placesContainer",n)})}},{key:"onLocationSelected",value:function(e){var t,n,o=this;return t=e.model,(n=t.fetch()).fail(function(){return h.request("xhr-error",n)}),n.done(function(){return console.log("MODEL",t),o.model.set(t.toJSON())})}},{key:"onLocationDelete",value:function(e){var t;return console.log("View",e),t=new b.default({model:e.model}),d.request("main:app:show-modal",t)}}]),t}();return e.prototype.template=i.default.renderable(function(e){return i.default.div(".map-container.col"),i.default.div(".places-container.col")}),e.prototype.className="row",e.prototype.ui={mapContainer:".map-container",placesContainer:".places-container"},e.prototype.regions={mapContainer:"@ui.mapContainer",placesContainer:"@ui.placesContainer"},e.prototype.childViewTriggers={"location:selected":"location:selected","location:delete":"location:delete"},e}.call(void 0),t.default=f},562:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=p(n(1)),a=p(n(2)),i=p(n(3)),l=p(n(8)),u=p(n(275)),c=p(n(564)),s=p(n(192)),d=p(n(569)),f=n(570);function p(e){return e&&e.__esModule?e:{default:e}}var h,y,b,m,w=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};y=r.default.Radio.channel("global"),m=r.default.Radio.channel("messages"),h=r.default.Radio.channel("places"),b=function(){var e=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.locationSuccess=e.locationSuccess.bind(e),e.locationError=e.locationError.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default.View),o(t,[{key:"onRender",value:function(){var e,t,n=this;return this.collection.length<1&&m.request("warning","No locations found"),e=this.collection.at(0),(t=e.fetch()).fail(function(){return m.request("xhr-error",t)}),t.done(function(){var t;return t=new s.default({model:e}),n.showChildView("mainMapContainer",t)})}},{key:"locationBtnClicked",value:function(){var e;return e={success:this.locationSuccess,error:this.locationError},y.request("main:app:getCurrentPosition",e),this.ui.locationBtn.removeClass("btn-primary"),this.ui.locationBtn.addClass("btn-warning")}},{key:"locationSuccess",value:function(e){var n,o,r;return w(this,t),this.ui.locationBtn.hide(),this.ui.mainMapContainer.hide(),n=(0,u.default)(e.coords),o=new(h.request("db:userlocation:modelClass"))({coords:n,timestamp:e.timestamp}),r=new c.default({model:o}),this.showChildView("locationStatus",r)}},{key:"locationError",value:function(e){return w(this,t),console.log("locationError",e),m.request("warning",e.message),this.ui.locationBtn.removeClass("btn-warning"),this.ui.locationBtn.addClass("btn-primary"),this.showWaitProgress()}},{key:"showWaitProgress",value:function(){var e,t,n,o,r,a,i=this;return this.ui.locationBtn.hide(),t=new f.ProgressModel,r=new f.ProgressView({className:"progress row",model:t,wrapperClasses:"col",childViewOptions:{className:"progress-bar progress-bar-striped bg-warning"}}),this.showChildView("waitProgress",r),o,a=function(){return i.getRegion("waitProgress").empty(),i.ui.locationBtn.show()},e=(0,l.default)("11s"),o=100,t.set("valuemax",e),t.set("valuenow",e),(n=new d.default).on("tick",function(e){return t.set("valuenow",e)}),n.on("done",function(){return a()}),n.start(e,{interval:(0,l.default)(".1s")})}},{key:"onAddLocationCancelled",value:function(){return this.getRegion("locationStatus").empty(),this.ui.locationBtn.show(),this.ui.mainMapContainer.show()}}]),t}();return e.prototype.template=i.default.renderable(function(e){return i.default.div(".row",function(){return i.default.span(function(){return i.default.button(".get-location-btn.btn.btn-primary",function(){return i.default.text("Get Location")})})}),i.default.div(".row",function(){return i.default.div(".col.wait-progress")}),i.default.div(".row.main-map-container")}),e.prototype.ui={locationStatus:".location-status",locationBtn:".get-location-btn",mainMapContainer:".main-map-container",waitProgress:".wait-progress"},e.prototype.regions={locationStatus:"@ui.locationStatus",mainMapContainer:"@ui.mainMapContainer",waitProgress:"@ui.waitProgress"},e.prototype.events={"click @ui.locationBtn":"locationBtnClicked"},e.prototype.childViewEvents={"add:location:cancelled":"onAddLocationCancelled"},e}.call(void 0),t.default=b},564:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=c(n(1)),l=c(n(2)),u=c(n(3));c(n(275));function c(e){return e&&e.__esModule?e:{default:e}}o=i.default.Radio.channel("global"),i.default.Radio.channel("messages"),i.default.Radio.channel("places"),r=function(){var e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.View),a(t,[{key:"addLocationBtnClicked",value:function(){var e=this;return console.log("addLocationBtnClicked"),n.e(92).then(function(){var t;return t=new(0,n(617).default)({model:e.model}),o.request("main:app:show-modal",t)}.bind(null,n)).catch(n.oe)}},{key:"cancelBtnClicked",value:function(){return this.trigger("add:location:cancelled")}}]),t}();return e.prototype.template=u.default.renderable(function(e){var t;return t=e.coords,u.default.div(".card",function(){return u.default.div(".card-body",function(){return u.default.dt("Latitude"),u.default.dd(t.latitude),u.default.dt("Longitude"),u.default.dd(t.longitude)}),u.default.div(".card-footer",function(){return u.default.button(".cancel-btn.btn.btn-warning","Cancel"),u.default.button(".add-location-btn.btn.btn-primary","Add location")})})}),e.prototype.ui={status:".status",addLocationBtn:".add-location-btn",cancelBtn:".cancel-btn"},e.prototype.events={"click @ui.addLocationBtn":"addLocationBtnClicked","click @ui.cancelBtn":"cancelBtnClicked"},e}.call(void 0),t.default=r}}]);
//# sourceMappingURL=places-view-index-9888eeef4b9e45bc2c47.js.map