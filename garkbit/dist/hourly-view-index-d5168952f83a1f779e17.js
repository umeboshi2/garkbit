(self.webpackJsonp=self.webpackJsonp||[]).push([[43],{513:function(t,e,n){"use strict";var o,r,u,i,a,l,s,f,c,d=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=b(n(1)),h=b(n(2)),w=b(n(3)),y=(b(n(28)),b(n(118))),v=(b(n(5)),b(n(514)));function b(t){return t&&t.__esModule?t:{default:t}}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}p.default.Radio.channel("global"),r=p.default.Radio.channel("messages"),p.default.Radio.channel("hourly"),l=w.default.renderable(function(t){return w.default.div(".row.listview-list-entry",function(){return w.default.text("You are not a worker.")})}),u=function(){var t=function(t){function e(){return k(this,e),_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return m(e,h.default.View),e}();return t.prototype.template=l,t}.call(void 0),f=w.default.renderable(function(t){var e;return w.default.div(".row.listview-list-entry",function(){return w.default.text(t.user.fullname+" is a worker.")}),w.default.div(".row.listview-list-entry.work-session"),e={action:"in",btnClass:".clock-btn.btn.btn-info.fa.fa-clock-o"},"in",null===t.status&&w.default.div(".row.listview-list-entry",function(){return w.default.text(t.user.fullname+" has never clocked in.")}),"on"===t.status&&(e.action="out",e.btnClass=".clock-btn.btn.btn-warning.fa.fa-clock-o"),w.default.div(".row",function(){return w.default.button(e.btnClass,function(){return w.default.text("Clock "+e.action)})})}),s=w.default.renderable(function(t){return w.default.div(function(){var e,n,o,r;return n=t.session,"off"===(r=t.worker.status)&&n.end?(e=(0,y.default)(n.end),w.default.text("Your last session ended "+e.fromNow())):"on"===r?(o=(0,y.default)(n.start),w.default.text("You have been working since "+o.fromNow())):void 0})}),i=function(){var t=function(t){function e(){return k(this,e),_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return m(e,h.default.View),d(e,[{key:"onSomething",value:function(){var t;return t=this.model.get("id"),new v.default({worker_id:t})}}]),e}();return t.prototype.template=s,t}.call(void 0),a=function(){var t=function(t){function e(){return k(this,e),_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return m(e,h.default.View),d(e,[{key:"ui",value:function(){return{clockBtn:".clock-btn",workSessionRegion:".work-session"}}},{key:"events",value:function(){return{"click @ui.clockBtn":"punchClock"}}},{key:"onRender",value:function(){var t,e=this;return this.model,(t=new v.default).fetch().done(function(){var n;return n=new i({model:t}),e.showChildView("workSessionRegion",n)})}},{key:"punchClock",value:function(){var t;return this.model,"off"===(t=this.model.get("status"))||null===t?this.punchIn():"on"===t?this.punchOut():r.request("warning","Bad worker status "+t)}},{key:"punchIn",value:function(){var t,e,n=this;return this.model.get("id"),t=new v.default,(e=t.save(null,{type:"POST",url:t.urlRoot})).done(function(){return n.updateLocalStatus("on")}),e.fail(function(){return r.request("warning",e.responseJSON.code)})}},{key:"punchOut",value:function(){var t,e,n=this;return e=this.model.get("id"),(t=new v.default({worker_id:e})).fetch().done(function(){var e;return(e=t.save()).done(function(){return n.updateLocalStatus("off")}),e.fail(function(){return r.request("warning",e.responseJSON.code)})})}},{key:"updateLocalStatus",value:function(t){return this.model.set("status",t),this.render()}}]),e}();return t.prototype.template=f,t.prototype.regions={workSessionRegion:"@ui.workSessionRegion"},t}.call(void 0),c=w.default.renderable(function(t){return w.default.div(".row.status")}),o=function(){var t=function(t){function e(){return k(this,e),_(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return m(e,h.default.View),d(e,[{key:"ui",value:function(){return{status:".status"}}},{key:"onRender",value:function(){var t,e=this;return(t=this.model.fetch()).done(function(){var t;return t=new a({model:e.model}),e.showChildView("status",t)}),t.fail(function(){var t;return t=new u({model:e.model}),e.showChildView("status",t)})}}]),e}();return t.prototype.template=c,t.prototype.regions={status:"@ui.status"},t.prototype.templateContext={appName:"hourly"},t}.call(void 0),t.exports=o},514:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,u,i,a=n(1),l=(o=a)&&o.__esModule?o:{default:o};u=l.default.Radio.channel("global"),l.default.Radio.channel("hourly"),r=u.request("main:app:AuthModel"),u.request("main:app:AuthCollection"),i=function(){var t=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),e}();return t.prototype.urlRoot="/api/dev/hourly/time-clock",t}.call(void 0),e.default=i}}]);
//# sourceMappingURL=hourly-view-index-d5168952f83a1f779e17.js.map